<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TVTOTO OPS ‚Äî World Class Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;800;900&family=Josefin+Sans:wght@100;200;300;400;500;600;700&family=JetBrains+Mono:wght@200;300;400;500;600&family=Playfair+Display:ital,wght@0,700;0,900;1,400&display=swap" rel="stylesheet">
<style>
:root{
  --void:#040101;--surface:#0b0202;--card:#120203;--elevated:#190304;--hover:#200405;
  --gold:#e8b94f;--gold2:#b8901c;--gold-pale:#f5e0a0;--gold-glow:rgba(232,185,79,.2);
  --ember:#ff9500;--amber:#ffb800;
  --red:#c41230;--red2:#9b0e26;--red3:#6b0818;
  --crimson:#e8173f;--scarlet:#ff2d55;--blood:#5c0011;
  --green:#22c55e;--teal:#00f5d4;--violet:#a855f7;--blue:#3b82f6;--orange:#f97316;
  --line-green:#06c755;--line-glow:rgba(6,199,85,.2);
  --t1:#fff0e8;--t2:#e8c4b0;--t3:#a05040;--t4:#5a2510;
  --border:rgba(200,60,40,.14);--border-gold:rgba(232,185,79,.22);--border-strong:rgba(200,60,40,.32);
  --sw:272px;--th:64px;--r1:16px;--r2:10px;--r3:6px;
  --ease:cubic-bezier(.4,0,.2,1);--ease-back:cubic-bezier(.34,1.56,.64,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{font-size:13.5px;}
body{
  font-family:'Josefin Sans',sans-serif;
  background:#040101 url('https://statics.hokibagus.club/tvtoto/background/tvtoto_backgroundweb.png') center/cover fixed;
  color:var(--t1);min-height:100vh;overflow-x:hidden;
}
body::before{content:'';position:fixed;inset:0;background:rgba(3,0,0,.85);z-index:0;pointer-events:none;backdrop-filter: blur(3px);}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");opacity:.04;pointer-events:none;z-index:0;}
.amb{position:fixed;pointer-events:none;z-index:0;border-radius:50%;filter:blur(100px);}
.amb-1{width:700px;height:400px;top:-100px;left:10%;background:radial-gradient(ellipse,rgba(196,18,48,.07),transparent 70%);}
.amb-2{width:400px;height:400px;bottom:0;right:5%;background:radial-gradient(ellipse,rgba(160,10,30,.05),transparent 70%);}
.amb-3{width:300px;height:200px;top:40%;left:45%;background:radial-gradient(ellipse,rgba(232,185,79,.04),transparent 70%);}

/* ‚îÄ‚îÄ FIREBASE STATUS INDICATOR ‚îÄ‚îÄ */
.fb-status{display:flex;align-items:center;gap:7px;padding:6px 13px;border-radius:var(--r2);background:rgba(6,199,85,.06);border:1px solid rgba(6,199,85,.15);font-family:'JetBrains Mono',monospace;font-size:9.5px;color:rgba(150,255,200,.6);letter-spacing:.1em;}
.fb-status.offline{background:rgba(232,23,63,.06);border-color:rgba(232,23,63,.18);color:rgba(255,100,100,.6);}
.fb-status.syncing{background:rgba(232,185,79,.06);border-color:rgba(232,185,79,.18);color:rgba(255,220,120,.7);}
.fb-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.fb-status .fb-dot{background:var(--line-green);box-shadow:0 0 7px var(--line-green);animation:blink 2s infinite;}
.fb-status.offline .fb-dot{background:var(--crimson);box-shadow:0 0 7px var(--crimson);}
.fb-status.syncing .fb-dot{background:var(--gold);box-shadow:0 0 7px var(--gold);animation:spin .8s linear infinite;}

/* ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê */
#login-screen{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(3,0,0,.97);transition:opacity .8s,visibility .8s;}
#login-screen.fade-out{opacity:0;visibility:hidden;pointer-events:none;}
.lp-wrap{position:absolute;inset:0;overflow:hidden;}
.lp{position:absolute;width:2px;height:2px;border-radius:50%;animation:lp-rise linear infinite;opacity:0;}
@keyframes lp-rise{0%{transform:translateY(100vh) scale(0);opacity:0;}10%{opacity:.8;}90%{opacity:.3;}100%{transform:translateY(-20vh) scale(.5);opacity:0;}}
.login-card{position:relative;z-index:1;width:440px;max-width:calc(100vw - 32px);background:linear-gradient(160deg,rgba(18,2,4,.98),rgba(10,1,2,.99));border:1px solid rgba(232,185,79,.18);border-radius:24px;overflow:hidden;box-shadow:0 40px 120px rgba(0,0,0,.8),0 0 0 1px rgba(196,18,48,.08),inset 0 1px 0 rgba(232,185,79,.08);animation:card-in .8s var(--ease-back) .3s both;}
@keyframes card-in{from{opacity:0;transform:translateY(40px) scale(.95);}to{opacity:1;transform:translateY(0) scale(1);}}
.login-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--gold),var(--crimson),var(--gold),transparent);animation:shimmer 3s ease infinite;}
@keyframes shimmer{0%,100%{opacity:.6;}50%{opacity:1;}}
.lhero{padding:40px 40px 26px;text-align:center;background:linear-gradient(180deg,rgba(196,18,48,.08),transparent);border-bottom:1px solid rgba(232,185,79,.07);}
.logo-ring{width:72px;height:72px;margin:0 auto 16px;position:relative;display:flex;align-items:center;justify-content:center;}
.logo-ring::before,.logo-ring::after{content:'';position:absolute;border-radius:50%;border:1px solid rgba(232,185,79,.25);animation:rpulse 2.5s ease-in-out infinite;}
.logo-ring::before{inset:-4px;}
.logo-ring::after{inset:-10px;animation-delay:.5s;border-color:rgba(232,185,79,.1);}
@keyframes rpulse{0%,100%{transform:scale(1);opacity:.5;}50%{transform:scale(1.08);opacity:1;}}
.logo-gem{width:72px;height:72px;border-radius:20px;background:linear-gradient(135deg,#c41230,#5c0011,#8b0000);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:26px;font-weight:800;color:var(--gold);box-shadow:0 0 40px rgba(196,18,48,.6),0 0 80px rgba(196,18,48,.2),inset 0 1px 0 rgba(255,255,255,.08);text-shadow:0 0 20px rgba(232,185,79,.8);position:relative;z-index:1;}
.lbrand{font-family:'Cinzel',serif;font-size:26px;font-weight:700;letter-spacing:.18em;background:linear-gradient(135deg,var(--gold-pale),var(--gold),var(--ember));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px;}
.lsub{font-size:10px;letter-spacing:.32em;text-transform:uppercase;color:rgba(160,80,60,.6);font-weight:300;}
.ldiv{width:60px;height:1px;margin:14px auto 0;background:linear-gradient(90deg,transparent,var(--gold),transparent);opacity:.35;}
.lbody{padding:30px 38px 34px;}
.lfield{margin-bottom:18px;}
.llabel{display:block;font-size:9px;font-weight:700;letter-spacing:.28em;text-transform:uppercase;color:var(--t3);margin-bottom:7px;}
.liw{position:relative;}
.lic{position:absolute;left:13px;top:50%;transform:translateY(-50%);font-size:14px;opacity:.45;pointer-events:none;}
.linput{width:100%;padding:12px 16px 12px 40px;background:rgba(255,255,255,.025);border:1px solid rgba(232,185,79,.1);border-radius:11px;color:var(--t1);font-family:'Josefin Sans',sans-serif;font-size:14px;outline:none;transition:all .3s var(--ease);}
.linput:focus{border-color:rgba(232,185,79,.38);background:rgba(232,185,79,.04);box-shadow:0 0 0 4px rgba(232,185,79,.06);}
.linput::placeholder{color:var(--t4);font-size:13px;font-style:italic;}
.leye{position:absolute;right:13px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--t2);cursor:pointer;opacity:.35;font-size:14px;transition:.2s;}
.leye:hover{opacity:.8;}
.lerr{background:rgba(196,18,48,.08);border:1px solid rgba(196,18,48,.22);border-radius:10px;padding:10px 14px;margin-bottom:16px;font-size:11.5px;color:var(--crimson);display:none;align-items:center;gap:8px;}
.lerr.show{display:flex;}
.btn-login{width:100%;padding:14px;position:relative;overflow:hidden;background:linear-gradient(135deg,#c41230,#8b0000,#c41230);background-size:200% 100%;border:1px solid rgba(196,18,48,.55);border-radius:12px;cursor:pointer;font-family:'Cinzel',serif;font-size:13px;font-weight:600;letter-spacing:.25em;text-transform:uppercase;color:#fff;box-shadow:0 8px 32px rgba(196,18,48,.38),inset 0 1px 0 rgba(255,255,255,.08);transition:all .4s var(--ease);animation:breathe 3s ease-in-out infinite;}
@keyframes breathe{0%,100%{box-shadow:0 8px 32px rgba(196,18,48,.38),inset 0 1px 0 rgba(255,255,255,.08);}50%{box-shadow:0 12px 44px rgba(196,18,48,.58),inset 0 1px 0 rgba(255,255,255,.12);}}
.btn-login::after{content:'';position:absolute;top:-50%;left:-60%;width:60%;height:200%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);transform:skewX(-20deg);transition:left .6s var(--ease);}
.btn-login:hover{background-position:100% 0;transform:translateY(-2px);}
.btn-login:hover::after{left:120%;}
.btn-login:active{transform:scale(.98);}
.lspin{display:none;width:18px;height:18px;border:2px solid rgba(255,255,255,.25);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;margin:0 auto;}
@keyframes spin{to{transform:rotate(360deg);}}
.lfoot{text-align:center;margin-top:18px;font-size:10px;color:rgba(160,80,60,.45);letter-spacing:.14em;}

/* ‚ïê‚ïê‚ïê APP SHELL ‚ïê‚ïê‚ïê */
#app{display:none;}
#app.visible{display:block;}

/* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
.sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sw);background:rgba(8,2,3,0.95);backdrop-filter:blur(24px);border-right:1px solid rgba(196,18,48,.16);display:flex;flex-direction:column;z-index:200;transition:transform .3s var(--ease);box-shadow:4px 0 60px rgba(100,5,15,.35);}
.sblogo{padding:20px 20px 18px;border-bottom:1px solid rgba(232,185,79,.07);}
.sb-row{display:flex;align-items:center;gap:11px;}
.sb-gem{width:37px;height:37px;background:linear-gradient(135deg,var(--red),var(--blood));border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:15px;font-weight:800;color:var(--gold);box-shadow:0 0 22px rgba(196,18,48,.5);text-shadow:0 0 10px rgba(232,185,79,.6);}
.sb-name{font-family:'Cinzel',serif;font-size:17px;font-weight:700;letter-spacing:.14em;background:linear-gradient(135deg,var(--gold-pale),var(--gold),var(--ember));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.sb-tag{font-family:'JetBrains Mono',monospace;font-size:8px;color:rgba(200,80,60,.4);letter-spacing:.22em;text-transform:uppercase;margin-top:1px;}
.sbnav{flex:1;padding:14px 10px;overflow-y:auto;display:flex;flex-direction:column;gap:2px;}
.nglabel{font-size:8.5px;letter-spacing:.28em;text-transform:uppercase;color:rgba(160,60,40,.45);padding:10px 14px 4px;font-weight:700;}
.nitem{display:flex;align-items:center;gap:11px;padding:10px 15px;border-radius:var(--r2);cursor:pointer;color:rgba(255,150,110,.5);font-family:'Josefin Sans',sans-serif;font-size:12.5px;font-weight:400;letter-spacing:.04em;transition:all .22s var(--ease);position:relative;border:1px solid transparent;user-select:none;}
.nitem:hover{background:rgba(196,18,48,.09);color:var(--t2);border-color:rgba(196,18,48,.14);}
.nitem.active{background:linear-gradient(135deg,rgba(196,18,48,.18),rgba(140,8,24,.1));color:var(--gold);font-weight:600;border-color:rgba(196,18,48,.32);box-shadow:0 2px 14px rgba(196,18,48,.12);}
.nitem.active::before{content:'';position:absolute;left:0;top:22%;bottom:22%;width:2px;background:linear-gradient(180deg,var(--gold),var(--crimson));border-radius:0 2px 2px 0;box-shadow:0 0 10px var(--crimson);}
.nitem.line-nav{color:rgba(6,199,85,.6);}
.nitem.line-nav:hover{background:rgba(6,199,85,.08);color:var(--line-green);border-color:rgba(6,199,85,.14);}
.nitem.line-nav.active{background:linear-gradient(135deg,rgba(6,199,85,.15),rgba(3,140,60,.1));color:var(--line-green);border-color:rgba(6,199,85,.3);}
.nitem.line-nav.active::before{background:linear-gradient(180deg,var(--line-green),#059669);}
.nico{font-size:14px;width:20px;text-align:center;flex-shrink:0;}
.sbfoot{padding:12px;border-top:1px solid rgba(196,18,48,.1);}
.sb-user{display:flex;align-items:center;gap:9px;padding:9px 13px;border-radius:var(--r2);background:rgba(232,185,79,.04);border:1px solid rgba(232,185,79,.09);margin-bottom:7px;cursor:pointer;transition:.2s;}
.sb-user:hover{background:rgba(232,185,79,.07);}
.sb-av{width:29px;height:29px;border-radius:8px;background:linear-gradient(135deg,var(--red),var(--red2));display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:12px;color:var(--gold);box-shadow:0 0 14px rgba(196,18,48,.28);flex-shrink:0;}
.sb-uname{font-family:'Josefin Sans',sans-serif;font-size:12px;font-weight:700;color:var(--gold);flex:1;letter-spacing:.05em;}
.sb-role{font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--t3);letter-spacing:.12em;text-transform:uppercase;display:block;margin-top:1px;}
.sb-lo{font-size:12px;opacity:.35;cursor:pointer;background:none;border:none;color:var(--t2);transition:.2s;padding:2px;}
.sb-lo:hover{opacity:.8;color:var(--crimson);}
.sysdot{width:7px;height:7px;border-radius:50%;background:var(--crimson);box-shadow:0 0 10px var(--crimson);animation:blink 2s infinite;flex-shrink:0;}
@keyframes blink{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.5;transform:scale(1.4);}}
.syslabel{font-family:'JetBrains Mono',monospace;font-size:10px;color:rgba(255,120,100,.55);letter-spacing:.08em;}
.syss{display:flex;align-items:center;gap:9px;padding:9px 13px;border-radius:var(--r2);background:rgba(196,18,48,.05);border:1px solid rgba(196,18,48,.13);}
.sb-toggle{display:none;position:fixed;top:14px;left:14px;z-index:300;background:var(--card);border:1px solid var(--border-gold);border-radius:var(--r3);padding:9px 12px;cursor:pointer;color:var(--gold);font-size:16px;}

/* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
.topbar{position:fixed;top:0;left:var(--sw);right:0;height:var(--th);background:rgba(9,1,2,.85);backdrop-filter:blur(24px);border-bottom:1px solid rgba(232,185,79,.09);display:flex;align-items:center;padding:0 26px;gap:16px;z-index:150;box-shadow:0 4px 40px rgba(0,0,0,.4);}
.tcrumb{font-family:'Josefin Sans',sans-serif;font-size:10.5px;color:rgba(255,130,90,.38);letter-spacing:.14em;font-weight:300;text-transform:uppercase;}
.tcrumb em{color:var(--gold);font-style:normal;font-weight:600;}
.spacer{flex:1;}
.tclock{font-family:'JetBrains Mono',monospace;font-size:20px;color:var(--t1);letter-spacing:.06em;font-weight:400;text-shadow:0 0 20px rgba(232,185,79,.18);}
.vdiv{width:1px;height:26px;background:rgba(200,60,40,.18);}
.tdb .d1{font-family:'Josefin Sans',sans-serif;font-size:12px;color:var(--t2);font-weight:500;text-align:right;letter-spacing:.04em;}
.tdb .d2{font-family:'JetBrains Mono',monospace;font-size:9px;color:rgba(255,130,90,.38);text-align:right;letter-spacing:.1em;}
.mbtn{display:flex;align-items:center;gap:7px;padding:7px 15px;border-radius:var(--r2);background:rgba(24,3,5,.8);border:1px solid rgba(232,185,79,.13);color:var(--t2);cursor:pointer;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;transition:all .2s;}
.mbtn.admin{background:linear-gradient(135deg,rgba(196,18,48,.14),rgba(140,8,24,.09));border-color:rgba(232,185,79,.28);color:var(--gold);}
.nbell{width:36px;height:36px;border-radius:var(--r2);background:rgba(24,3,5,.8);border:1px solid rgba(232,185,79,.11);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;transition:all .2s;position:relative;}
.nbell:hover{border-color:rgba(232,185,79,.28);}
.npip{position:absolute;top:6px;right:6px;width:7px;height:7px;border-radius:50%;background:var(--crimson);border:1.5px solid var(--void);}

/* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
.main{margin-left:var(--sw);padding-top:var(--th);min-height:100vh;position:relative;z-index:1;}
.page{display:none;padding:26px;animation:fadeUp .3s var(--ease);}
.page.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.ph{margin-bottom:26px;}
.ph-title{font-family:'Cinzel',serif;font-size:29px;font-weight:700;letter-spacing:.06em;line-height:1;}
.ph-title span{background:linear-gradient(135deg,var(--gold-pale),var(--gold),var(--ember));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.ph-sub{font-family:'Josefin Sans',sans-serif;font-size:11px;color:rgba(255,160,120,.45);margin-top:5px;letter-spacing:.1em;font-weight:300;text-transform:uppercase;}

/* ‚îÄ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ‚îÄ */
.panel{background:rgba(18, 2, 4, 0.6);backdrop-filter:blur(12px);border:1px solid rgba(196,18,48,.14);border-radius:var(--r1);overflow:hidden;margin-bottom:16px;box-shadow:0 10px 40px rgba(0,0,0,.4);}
.panel:last-child{margin-bottom:0;}
.panel.line-panel{border-color:rgba(6,199,85,.18);}
.phd{padding:17px 22px;border-bottom:1px solid rgba(232,185,79,.05);background:linear-gradient(135deg,rgba(196,18,48,.09),rgba(100,5,10,.05));display:flex;align-items:center;gap:11px;flex-wrap:wrap;position:relative;overflow:hidden;}
.phd::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(232,185,79,.18),transparent);}
.panel.line-panel .phd{background:linear-gradient(135deg,rgba(6,199,85,.08),rgba(3,120,50,.04));}
.panel.line-panel .phd::before{background:linear-gradient(90deg,transparent,rgba(6,199,85,.3),transparent);}
.ptitle{font-family:'Cinzel',serif;font-size:14.5px;font-weight:600;letter-spacing:.1em;flex:1;color:var(--t1);}
.pbadge{font-family:'Josefin Sans',sans-serif;font-size:9.5px;font-weight:700;letter-spacing:.18em;background:rgba(232,185,79,.07);color:var(--amber);border:1px solid rgba(232,185,79,.2);padding:3px 11px;border-radius:20px;white-space:nowrap;text-transform:uppercase;}
.pbadge.cb{background:rgba(255,107,53,.06);color:#ff9966;border-color:rgba(255,107,53,.22);}
.pbadge.rb{background:rgba(232,23,63,.07);color:var(--crimson);border-color:rgba(232,23,63,.18);}
.pbadge.vb{background:rgba(168,85,247,.07);color:#c084fc;border-color:rgba(168,85,247,.18);}
.pbadge.gb{background:rgba(34,197,94,.07);color:var(--green);border-color:rgba(34,197,94,.18);}
.pbadge.lb{background:rgba(6,199,85,.1);color:var(--line-green);border-color:rgba(6,199,85,.28);}
.pbd{padding:20px;}

/* ‚îÄ‚îÄ‚îÄ STAT GRID ‚îÄ‚îÄ‚îÄ */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px;}
.scard{background:rgba(18, 2, 4, 0.7);backdrop-filter:blur(8px);border:1px solid rgba(196,18,48,.13);border-radius:var(--r1);padding:20px 20px 16px;transition:all .3s var(--ease);position:relative;overflow:hidden;animation:fadeUp .4s var(--ease) both;box-shadow:0 8px 30px rgba(0,0,0,.4);}
.scard::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;opacity:0;transition:.3s;}
.scard:hover{transform:translateY(-4px);border-color:rgba(232,185,79,.32);box-shadow:0 16px 48px rgba(196,18,48,.18);}
.scard:hover::before{opacity:1;}
.sc-gold::before{background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.sc-cyan::before{background:linear-gradient(90deg,transparent,#ff8844,transparent);}
.sc-rose::before{background:linear-gradient(90deg,transparent,var(--crimson),transparent);}
.sc-green::before{background:linear-gradient(90deg,transparent,var(--green),transparent);}
.sc-line::before{background:linear-gradient(90deg,transparent,var(--line-green),transparent);}
.sc-glow{position:absolute;top:-20px;right:-20px;width:70px;height:70px;border-radius:50%;filter:blur(30px);opacity:.12;}
.sc-gold .sc-glow{background:var(--gold);}
.sc-cyan .sc-glow{background:#ff8844;}
.sc-rose .sc-glow{background:var(--crimson);}
.sc-green .sc-glow{background:var(--green);}
.sc-line .sc-glow{background:var(--line-green);}
.scard:nth-child(1){animation-delay:.05s;}.scard:nth-child(2){animation-delay:.1s;}.scard:nth-child(3){animation-delay:.15s;}.scard:nth-child(4){animation-delay:.2s;}.scard:nth-child(5){animation-delay:.25s;}.scard:nth-child(6){animation-delay:.3s;}
.sc-ico{font-size:19px;margin-bottom:11px;}
.sc-label{font-family:'Josefin Sans',sans-serif;font-size:9px;text-transform:uppercase;letter-spacing:.24em;color:rgba(255,140,100,.42);margin-bottom:9px;font-weight:700;}
.sc-val{font-family:'Cinzel',serif;font-size:44px;line-height:1;margin-bottom:7px;font-weight:700;}
.sc-gold .sc-val{color:var(--gold);text-shadow:0 0 22px rgba(232,185,79,.38);}
.sc-cyan .sc-val{color:#ff9944;text-shadow:0 0 18px rgba(255,153,68,.28);}
.sc-rose .sc-val{color:var(--crimson);text-shadow:0 0 18px rgba(232,23,63,.35);}
.sc-green .sc-val{color:var(--green);text-shadow:0 0 14px rgba(34,197,94,.28);}
.sc-line .sc-val{color:var(--line-green);text-shadow:0 0 18px rgba(6,199,85,.4);}
.sc-meta{font-family:'Josefin Sans',sans-serif;font-size:11px;color:rgba(255,160,120,.38);letter-spacing:.04em;}

/* ‚îÄ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}

/* ‚îÄ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ */
.fg{margin-bottom:14px;}
.fl{display:block;font-family:'Josefin Sans',sans-serif;font-size:9.5px;font-weight:700;letter-spacing:.22em;text-transform:uppercase;color:var(--t3);margin-bottom:7px;}
.fi,.fsel,.fta{width:100%;padding:10px 14px;background:rgba(255,255,255,.023);border:1px solid rgba(196,18,48,.14);border-radius:var(--r2);color:var(--t1);font-family:'Josefin Sans',sans-serif;font-size:13.5px;transition:all .2s var(--ease);outline:none;}
.fi:focus,.fsel:focus,.fta:focus{border-color:rgba(196,18,48,.42);background:rgba(196,18,48,.05);box-shadow:0 0 0 3px rgba(196,18,48,.09);}
.fsel{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23a05040' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:10px;}
.fsel option{background:#0d0202;color:var(--t1);}
.fta{resize:vertical;min-height:100px;font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.7;}
.fr2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.fr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
.total-h{padding:10px 14px;background:rgba(196,18,48,.05);border:1px solid rgba(196,18,48,.16);border-radius:var(--r2);font-family:'JetBrains Mono',monospace;font-size:14px;color:#ff9999;text-align:center;min-height:42px;display:flex;align-items:center;justify-content:center;}

/* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
.btn{padding:10px 18px;border-radius:var(--r2);font-family:'Josefin Sans',sans-serif;font-size:12px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;cursor:pointer;transition:all .25s var(--ease);border:none;display:inline-flex;align-items:center;gap:7px;position:relative;overflow:hidden;}
.btn::after{content:'';position:absolute;top:-50%;left:-60%;width:60%;height:200%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);transform:skewX(-20deg);transition:left .5s var(--ease);pointer-events:none;}
.btn:hover::after{left:130%;}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#000;box-shadow:0 4px 18px rgba(232,185,79,.28);font-weight:700;}
.btn-gold:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(232,185,79,.42);}
.btn-ghost{background:rgba(20,2,4,.7);border:1px solid rgba(196,18,48,.18);color:var(--t2);}
.btn-ghost:hover{background:rgba(38,4,8,.9);color:var(--t1);border-color:rgba(196,18,48,.42);}
.btn-cyan{background:rgba(255,100,40,.09);border:1px solid rgba(255,100,40,.22);color:#ff9966;}
.btn-cyan:hover{background:rgba(255,100,40,.16);transform:translateY(-1px);}
.btn-rose{background:rgba(232,23,63,.09);border:1px solid rgba(232,23,63,.25);color:var(--crimson);}
.btn-rose:hover{background:rgba(232,23,63,.16);}
.btn-violet{background:rgba(168,85,247,.09);border:1px solid rgba(168,85,247,.25);color:#c084fc;}
.btn-violet:hover{background:rgba(168,85,247,.16);}
.btn-line{background:rgba(6,199,85,.09);border:1px solid rgba(6,199,85,.25);color:var(--line-green);}
.btn-line:hover{background:rgba(6,199,85,.16);transform:translateY(-1px);box-shadow:0 6px 20px rgba(6,199,85,.18);}
.btn-sm{padding:6px 13px;font-size:10.5px;}
.btn-full{width:100%;justify-content:center;padding:12px;}
.btn-rnd{padding:14px 32px;font-family:'Cinzel',serif;font-size:14px;font-weight:600;letter-spacing:.18em;background:linear-gradient(135deg,rgba(0,245,212,.12),rgba(232,185,79,.08));border:1.5px solid rgba(0,245,212,.28);color:#00f5d4;border-radius:var(--r1);cursor:pointer;transition:all .3s var(--ease);display:inline-flex;align-items:center;gap:11px;position:relative;overflow:hidden;}
.btn-rnd:hover{transform:translateY(-2px);box-shadow:0 10px 40px rgba(0,245,212,.16);border-color:#00f5d4;}
.btn-rnd:active{transform:scale(.97);}
.dice-ico{font-size:22px;transition:transform .25s;}
.btn-rnd:hover .dice-ico{transform:rotate(20deg) scale(1.1);}

/* ‚îÄ‚îÄ‚îÄ PASTE BOX ‚îÄ‚îÄ‚îÄ */
.pbox{width:100%;min-height:150px;padding:16px;background:linear-gradient(135deg,rgba(196,18,48,.03),rgba(140,8,24,.02));border:1.5px dashed rgba(196,18,48,.28);border-radius:var(--r1);color:var(--t1);font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.8;resize:vertical;outline:none;transition:all .25s var(--ease);}
.pbox:focus{border-color:rgba(196,18,48,.52);background:rgba(196,18,48,.05);box-shadow:0 0 0 4px rgba(196,18,48,.07);}
.pbox::placeholder{color:var(--t4);}
.pcorner{display:flex;gap:9px;margin-top:10px;justify-content:flex-end;}

/* ‚îÄ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ‚îÄ */
.tbl-wrap{overflow-x:auto;}
.tbl-ctrl{display:flex;gap:10px;padding:12px 20px;border-bottom:1px solid rgba(196,18,48,.09);flex-wrap:wrap;background:rgba(10,1,1,.5);}
.sbox{display:flex;align-items:center;gap:7px;background:rgba(24,3,5,.8);border:1px solid rgba(196,18,48,.14);border-radius:var(--r2);padding:7px 12px;flex:1;min-width:170px;}
.sbox input{background:none;border:none;outline:none;color:var(--t1);font-family:'Josefin Sans',sans-serif;font-size:13px;width:100%;}
.sico{font-size:13px;color:var(--t3);}
.fsel2{padding:7px 12px;background:rgba(24,3,5,.8);border:1px solid rgba(196,18,48,.14);border-radius:var(--r2);color:var(--t2);font-family:'Josefin Sans',sans-serif;font-size:12px;outline:none;cursor:pointer;}
.tbl{width:100%;border-collapse:collapse;}
.tbl th{text-align:left;padding:14px 16px;font-family:'Josefin Sans',sans-serif;font-size:9.5px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;white-space:nowrap;}
.tbl td{padding:14px 16px;border-bottom:1px solid rgba(196,18,48,.07);color:var(--t1);}
.tbl tr:hover td{background:rgba(196,18,48,.03);}
.av{width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,var(--red),var(--red2));display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:12px;color:var(--gold);margin-right:11px;font-weight:700;box-shadow:0 0 10px rgba(196,18,48,.2);}
.badge{padding:4px 10px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;display:inline-flex;align-items:center;gap:5px;}
.b-pagi{background:rgba(232,185,79,.1);color:var(--gold);}
.b-sore{background:rgba(249,115,22,.1);color:#fb923c;}
.b-malam{background:rgba(168,85,247,.1);color:#c084fc;}
.b-active{background:rgba(34,197,94,.1);color:var(--green);border:1px solid rgba(34,197,94,.22);}
.b-pending{background:rgba(255,255,255,.05);color:var(--t2);}
.b-done{background:rgba(150,150,150,.1);color:var(--t3);}
.b-line{background:rgba(6,199,85,.1);color:var(--line-green);border:1px solid rgba(6,199,85,.25);}
.b-sanksi{background:rgba(232,23,63,.1);color:var(--crimson);border:1px solid rgba(232,23,63,.3);}
.live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;box-shadow:0 0 8px var(--green);animation:blink 1.5s infinite;}
.jdb{font-family:'Josefin Sans',sans-serif;font-size:11.5px;font-weight:700;letter-spacing:.06em;color:var(--t1);}
.jdb-op{color:#c084fc;text-shadow:0 0 10px rgba(192,132,252,.3);}
.jdb-rnd{color:#00f5d4;text-shadow:0 0 10px rgba(0,245,212,.2);}
.empty-red{display:flex;flex-direction:column;align-items:center;padding:36px;text-align:center;opacity:.5;}
.eri{font-size:28px;margin-bottom:8px;color:var(--crimson);}
.ert{font-family:'Josefin Sans',sans-serif;font-size:12px;color:var(--t3);text-transform:uppercase;letter-spacing:.16em;}

/* ‚îÄ‚îÄ‚îÄ DASHBOARD LIST ‚îÄ‚îÄ‚îÄ */
.scard2{background:linear-gradient(90deg,rgba(196,18,48,.07),transparent);border-bottom:1px solid rgba(196,18,48,.11);padding:10px 14px;transition:all .2s;}
.scard2:last-child{border:none;}
.scard2:hover{background:rgba(196,18,48,.12);padding-left:18px;}
.tbar{height:3px;background:rgba(255,255,255,.05);border-radius:3px;overflow:hidden;margin:8px 0 6px;}
.tfill{height:100%;background:linear-gradient(90deg,var(--gold),var(--crimson));border-radius:3px;box-shadow:0 0 10px var(--crimson);}
.check-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;}
.check-item{background:rgba(10,1,2,.6);border:1px solid var(--border);border-radius:var(--r2);padding:10px;display:flex;align-items:center;gap:11px;transition:.2s;}
.check-item:hover{background:rgba(196,18,48,.08);border-color:rgba(196,18,48,.3);}
.cbox{width:18px;height:18px;border:1.5px solid var(--t3);border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;}
.cbox.checked{background:var(--green);border-color:var(--green);box-shadow:0 0 10px rgba(34,197,94,.4);}
.cbox.checked::after{content:'‚úî';font-size:11px;color:#000;font-weight:700;}

/* ‚îÄ‚îÄ‚îÄ ABSENSI CARD ‚îÄ‚îÄ‚îÄ */
.absen-hero{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px;}
.asc{background:linear-gradient(145deg,rgba(20,2,5,.9),rgba(12,1,2,.95));border:1px solid rgba(196,18,48,.16);border-radius:var(--r1);padding:18px;position:relative;overflow:hidden;display:flex;flex-direction:column;align-items:center;text-align:center;}
.asc-shine{position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.05),transparent);pointer-events:none;}
.asc-bar{position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--t3);opacity:.3;}
.asc-late .asc-bar{background:var(--crimson);opacity:1;box-shadow:0 0 10px var(--crimson);}
.asc-ok .asc-bar{background:var(--green);opacity:1;box-shadow:0 0 10px var(--green);}
.asc-pend .asc-bar{background:var(--gold);opacity:.6;}
.asc-icon{font-size:24px;margin-bottom:6px;filter:drop-shadow(0 0 10px rgba(0,0,0,.5));}
.asc-val{font-family:'Cinzel',serif;font-size:32px;font-weight:700;line-height:1;margin-bottom:4px;color:var(--t1);}
.asc-label{font-family:'Josefin Sans',sans-serif;font-size:9.5px;letter-spacing:.18em;text-transform:uppercase;color:var(--t3);}
.asc-late .asc-val{color:var(--crimson);text-shadow:0 0 15px rgba(232,23,63,.4);}
.asc-ok .asc-val{color:var(--green);text-shadow:0 0 15px rgba(34,197,94,.3);}
.atabs{display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;padding-bottom:5px;}
.atab{padding:8px 16px;background:rgba(255,255,255,.03);border:1px solid rgba(196,18,48,.12);border-radius:20px;color:var(--t2);font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:600;letter-spacing:.08em;cursor:pointer;transition:.2s;white-space:nowrap;}
.atab:hover{background:rgba(196,18,48,.08);}
.atab.active{background:rgba(196,18,48,.18);color:var(--gold);border-color:rgba(196,18,48,.35);box-shadow:0 0 15px rgba(196,18,48,.15);}
.absen-layout{display:grid;grid-template-columns:2fr 1.2fr;gap:20px;}
.absen-ipanel{background:rgba(14,2,3,.6);border:1px solid rgba(196,18,48,.14);border-radius:var(--r1);overflow:hidden;}
.aphd{background:linear-gradient(90deg,rgba(196,18,48,.08),transparent);padding:14px 20px;border-bottom:1px solid rgba(196,18,48,.14);display:flex;align-items:center;justify-content:space-between;}
.aphd-title{font-family:'Cinzel',serif;font-size:13px;font-weight:700;letter-spacing:.1em;color:var(--t1);display:flex;align-items:center;gap:8px;}
.aphd-ico{color:var(--gold);}
.tolbanner{background:rgba(232,23,63,.08);border-bottom:1px solid rgba(232,23,63,.15);padding:10px 20px;display:flex;align-items:center;gap:12px;}
.tol-ico{font-size:16px;color:var(--crimson);}
.tol-txt{font-family:'Josefin Sans',sans-serif;font-size:11px;color:var(--t2);flex:1;line-height:1.4;}
.tol-time{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;color:var(--crimson);background:rgba(0,0,0,.3);padding:4px 8px;border-radius:6px;border:1px solid rgba(232,23,63,.2);}
.staff-list{max-height:600px;overflow-y:auto;padding:16px;}
.sacard{display:grid;grid-template-columns:38px 1.5fr 70px 90px 70px 38px;align-items:center;gap:12px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.05);border-radius:12px;padding:10px 14px;margin-bottom:10px;transition:all .3s var(--ease);animation:fadeUp .4s var(--ease) both;}
.sacard:hover{background:rgba(255,255,255,.04);transform:translateX(4px);}
.sacard.is-late{border-color:rgba(232,23,63,.4);background:linear-gradient(90deg,rgba(232,23,63,.08),transparent);}
.sacard.is-ok{border-color:rgba(34,197,94,.3);background:linear-gradient(90deg,rgba(34,197,94,.06),transparent);}
.sa-av{width:38px;height:38px;border-radius:10px;background:#222;display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-weight:700;color:var(--t2);font-size:13px;}
.av-l{background:linear-gradient(135deg,var(--crimson),#7f1d1d);color:#fff;box-shadow:0 0 10px rgba(220,38,38,.4);}
.av-o{background:linear-gradient(135deg,var(--green),#064e3b);color:#fff;box-shadow:0 0 10px rgba(22,163,74,.3);}
.av-d{background:linear-gradient(135deg,#333,#111);color:#666;}
.sa-name{font-family:'Josefin Sans',sans-serif;font-size:13px;font-weight:700;color:var(--t1);margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sa-meta{display:flex;gap:8px;font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--t3);}
.sa-sb{padding:1px 6px;border-radius:4px;font-weight:700;}
.sa-id{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);border-radius:6px;padding:6px 8px;color:var(--gold);font-family:'JetBrains Mono',monospace;font-size:11px;text-align:center;outline:none;transition:.2s;}
.sa-id:focus{border-color:var(--gold);background:rgba(232,185,79,.05);}
.sa-ti{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);border-radius:6px;padding:6px 8px;color:var(--t1);font-family:'JetBrains Mono',monospace;font-size:12px;text-align:center;outline:none;transition:.2s;}
.sa-ti:focus{border-color:var(--blue);background:rgba(59,130,246,.08);}
.sa-ti.t-late{color:var(--crimson);border-color:rgba(232,23,63,.4);background:rgba(232,23,63,.05);}
.sa-ti.t-ok{color:var(--green);border-color:rgba(34,197,94,.4);background:rgba(34,197,94,.05);}
.sp{font-family:'Josefin Sans',sans-serif;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;display:flex;align-items:center;gap:5px;}
.sp-late{color:var(--crimson);}
.sp-ok{color:var(--green);}
.sp-belum{color:var(--t3);}
.spd{width:4px;height:4px;border-radius:50%;background:currentColor;box-shadow:0 0 5px currentColor;}
.hbtn{width:38px;height:38px;border-radius:10px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;}
.hbtn-idle{background:rgba(255,255,255,.06);color:var(--t3);}
.hbtn-idle:hover{background:var(--blue);color:#fff;box-shadow:0 0 15px rgba(59,130,246,.4);}
.hbtn-done{background:var(--green);color:#fff;box-shadow:0 0 10px rgba(34,197,94,.3);}
.hbtn-confirm{animation:pulseGreen .4s ease;}
@keyframes pulseGreen{0%{transform:scale(1);}50%{transform:scale(1.2);box-shadow:0 0 20px var(--green);}100%{transform:scale(1);}}
.hico{width:18px;height:18px;}
.atbar{padding:14px 20px;border-top:1px solid rgba(196,18,48,.14);display:flex;justify-content:flex-end;gap:10px;background:rgba(10,1,2,.4);}
.btn-now{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);color:#60a5fa;padding:8px 16px;border-radius:8px;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.06em;cursor:pointer;display:flex;align-items:center;gap:6px;transition:.2s;}
.btn-now:hover{background:rgba(59,130,246,.2);transform:translateY(-1px);}
.btn-hadall{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:var(--green);padding:8px 16px;border-radius:8px;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.06em;cursor:pointer;display:flex;align-items:center;gap:6px;transition:.2s;}
.btn-hadall:hover{background:rgba(34,197,94,.2);transform:translateY(-1px);box-shadow:0 4px 12px rgba(34,197,94,.15);}
.btn-simp{background:linear-gradient(135deg,var(--gold),var(--gold2));border:none;color:#000;padding:8px 20px;border-radius:8px;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:800;letter-spacing:.08em;cursor:pointer;display:flex;align-items:center;gap:6px;transition:.2s;box-shadow:0 4px 12px rgba(232,185,79,.2);}
.btn-simp:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(232,185,79,.3);}
.late-rpanel{background:rgba(14,2,3,.6);border:1px solid rgba(196,18,48,.14);border-radius:var(--r1);overflow:hidden;position:sticky;top:90px;}
.lrphd{background:linear-gradient(90deg,rgba(196,18,48,.12),transparent);padding:16px 20px;border-bottom:1px solid rgba(196,18,48,.14);display:flex;align-items:center;justify-content:space-between;}
.lrptitle{font-family:'Cinzel',serif;font-size:12.5px;font-weight:700;color:var(--crimson);letter-spacing:.06em;display:flex;align-items:center;gap:8px;}
.btn-copyall{background:none;border:1px solid rgba(232,23,63,.3);color:var(--crimson);padding:4px 10px;border-radius:6px;font-size:10px;font-weight:700;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:5px;}
.btn-copyall:hover{background:rgba(232,23,63,.1);}
.late-list{max-height:600px;overflow-y:auto;padding:16px;}
.lri{background:rgba(255,255,255,.02);border:1px solid rgba(196,18,48,.1);border-radius:10px;margin-bottom:10px;overflow:hidden;}
.lri-hd{padding:10px 12px;background:rgba(196,18,48,.05);display:flex;align-items:center;gap:10px;}
.lri-av{width:24px;height:24px;border-radius:6px;background:var(--crimson);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#fff;}
.lri-name{font-family:'Josefin Sans',sans-serif;font-size:11.5px;font-weight:700;color:var(--t1);}
.lri-sid{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--t3);margin-left:6px;background:rgba(0,0,0,.3);padding:2px 5px;border-radius:4px;}
.lri-lc{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--crimson);font-weight:700;background:rgba(232,23,63,.1);padding:3px 8px;border-radius:4px;margin-left:auto;}
.lri-cpbtn{background:rgba(255,255,255,.05);border:none;color:var(--t2);font-size:10px;padding:4px 8px;border-radius:4px;cursor:pointer;transition:.2s;}
.lri-cpbtn:hover{background:rgba(255,255,255,.1);color:#fff;}
.lri-cpbtn.copied{background:var(--green);color:#fff;}
.lri-bd{padding:10px 12px;}
.rtb{width:100%;height:100px;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.05);border-radius:6px;padding:8px;color:var(--t2);font-family:'JetBrains Mono',monospace;font-size:9.5px;resize:none;outline:none;line-height:1.5;white-space:pre-wrap;overflow-y:auto;}
.rtb.flash{animation:flashWhite .3s ease;}
@keyframes flashWhite{0%{background:rgba(255,255,255,.2);}100%{background:rgba(0,0,0,.3);}}

/* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
.toast-wrap{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:10px;pointer-events:none;}
.toast{background:rgba(15,2,4,.95);border:1px solid;border-radius:12px;padding:12px 18px;min-width:280px;display:flex;align-items:center;gap:12px;box-shadow:0 10px 40px rgba(0,0,0,.6);transform:translateX(120%);transition:transform .4s cubic-bezier(.175,.885,.32,1.275);backdrop-filter:blur(10px);pointer-events:auto;}
.toast.show{transform:translateX(0);}
.t-ok{border-color:rgba(34,197,94,.3);color:var(--green);}
.t-info{border-color:rgba(232,185,79,.3);color:var(--gold);}
.t-warn{border-color:rgba(232,23,63,.3);color:var(--crimson);}
.toast span:first-child{font-size:18px;}
.toast span:last-child{font-family:'Josefin Sans',sans-serif;font-size:12.5px;font-weight:600;letter-spacing:.04em;color:var(--t1);}

/* ‚îÄ‚îÄ‚îÄ HISTORY LOG ‚îÄ‚îÄ‚îÄ */
.log-item{display:flex;gap:14px;padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);align-items:flex-start;animation:fadeUp .3s var(--ease);}
.log-time{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--t3);margin-top:2px;min-width:35px;}
.log-dot{width:8px;height:8px;border-radius:50%;margin-top:4px;box-shadow:0 0 8px currentColor;}
.log-title{font-family:'Josefin Sans',sans-serif;font-size:12px;font-weight:600;color:var(--t1);letter-spacing:.02em;}
.log-desc{font-family:'JetBrains Mono',monospace;font-size:10.5px;color:var(--t2);margin-top:2px;}

/* ‚îÄ‚îÄ‚îÄ OP SLOTS ‚îÄ‚îÄ‚îÄ */
.op-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:14px;}
.op-slot{background:rgba(20,2,4,.8);border:1.5px solid rgba(196,18,48,.17);border-radius:var(--r1);padding:14px;}
.op-slot-label{font-family:'Josefin Sans',sans-serif;font-size:9px;text-transform:uppercase;letter-spacing:.2em;color:#ff9966;margin-bottom:10px;display:flex;align-items:center;gap:7px;font-weight:700;}
.op-slot-num{width:19px;height:19px;background:rgba(196,18,48,.18);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:#ff9999;}
.op-tag{display:inline-flex;align-items:center;gap:5px;background:rgba(196,18,48,.1);border:1px solid rgba(196,18,48,.26);color:#ff9966;padding:3px 10px;border-radius:20px;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.05em;}

/* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-track{background:rgba(10,1,2,.8);}
::-webkit-scrollbar-thumb{background:rgba(160,10,25,.55);border-radius:3px;}

/* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
@media(max-width:960px){
  .sidebar{transform:translateX(-100%);}
  .sidebar.open{transform:translateX(0);}
  .sb-toggle{display:flex;}
  .main,.topbar{left:0;margin-left:0;}
  .topbar{left:0;padding:0 50px 0 14px;}
  .stat-grid,.line-stat-grid{grid-template-columns:1fr 1fr;}
  .g2,.g3,.fr2,.fr3,.op-grid{grid-template-columns:1fr;}
  .page{padding:14px;}
  .absen-layout{grid-template-columns:1fr;}
  .late-rpanel,.line-report-panel{position:static;}
}
@media(max-width:520px){
  .stat-grid,.line-stat-grid{grid-template-columns:1fr;}
  .lsacard,.sacard{grid-template-columns:30px 1fr;gap:7px;}
  .sa-id,.sa-ti,.lsa-ti{width:78px;}
}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(4px)}}
.spinning{animation:spin .4s linear infinite;}
</style>
</head>
<body>
<div class="amb amb-1"></div><div class="amb amb-2"></div><div class="amb amb-3"></div>
<div class="toast-wrap" id="tw"></div>

<!-- ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê -->
<div id="login-screen">
  <div class="lp-wrap" id="lp-wrap"></div>
  <div class="login-card">
    <div class="lhero">
      <div class="logo-ring"><div class="logo-gem">T</div></div>
      <div class="lbrand">TVTOTO OPS</div>
      <div class="lsub">Command Center ‚Äî Akses Terbatas</div>
      <div class="ldiv"></div>
    </div>
    <div class="lbody">
      <div class="lerr" id="lerr"><span>‚ö†</span><span id="lerr-msg">Kredensial tidak valid.</span></div>
      <div class="lfield"><label class="llabel">Username</label><div class="liw"><span class="lic">üë§</span><input class="linput" id="lu" type="text" placeholder="Masukkan username‚Ä¶" onkeydown="if(event.key==='Enter')doLogin()"></div></div>
      <div class="lfield"><label class="llabel">Password</label><div class="liw"><span class="lic">üîí</span><input class="linput" id="lp" type="password" placeholder="Masukkan password‚Ä¶" onkeydown="if(event.key==='Enter')doLogin()"><button class="leye" id="leye" onclick="toggleEye()">üëÅ</button></div></div>
      <button class="btn-login" id="lbtn" onclick="doLogin()"><span id="lbtxt">Masuk ke Dashboard</span><div class="lspin" id="lspin"></div></button>
      <div class="lfoot">TVTOTO OPS v4.1 ‚Äî FIREBASE CLOUD SYNC</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div id="app">
<button class="sb-toggle" onclick="toggleSb()">‚ò∞</button>

<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
  <div class="sblogo">
    <div class="sb-row">
      <div class="sb-gem">T</div>
      <div><div class="sb-name">TVTOTO OPS</div><div class="sb-tag">Cloud Sync Active</div></div>
    </div>
  </div>
  <div class="sbnav">
    <div class="nglabel">Menu Utama</div>
    <div class="nitem active" onclick="gp('dashboard',this)"><span class="nico">‚óà</span>Dashboard</div>
    <div class="nitem" onclick="gp('jobdesk-acak',this)"><span class="nico">üé≤</span>Acak Jobdesk</div>
    <div class="nitem" onclick="gp('operator',this)"><span class="nico">üëë</span>Setting Operator</div>
    <div class="nitem" onclick="gp('shift',this)"><span class="nico">‚è±</span>Manajemen Shift</div>
    <div class="nitem" onclick="gp('monitor',this)"><span class="nico">üì°</span>Monitor Real-time</div>
    <div class="nglabel">Absensi</div>
    <div class="nitem" onclick="gp('absen',this)"><span class="nico">üïê</span>Absensi Staff</div>
    <div class="nitem line-nav" onclick="gp('absen-line',this)"><span class="nico">üí¨</span>Absensi LINE</div>
    <div class="nglabel">Laporan</div>
    <div class="nitem" onclick="gp('history',this)"><span class="nico">üóÇ</span>History Log</div>
    <div class="nitem" onclick="gp('export',this)"><span class="nico">‚¨á</span>Export Data</div>
  </div>
  <div class="sbfoot">
    <div class="sb-user" id="sbu" onclick="confirmLogout()">
      <div class="sb-av" id="sbav">A</div>
      <div style="flex:1;min-width:0;"><div class="sb-uname" id="sbn">ADMIN</div><span class="sb-role" id="sbr">Administrator</span></div>
      <button class="sb-lo" title="Logout">‚èè</button>
    </div>
    <!-- FIREBASE STATUS -->
    <div class="fb-status" id="fb-status" style="margin-bottom:7px;">
      <div class="fb-dot"></div>
      <span id="fb-status-text">Connecting...</span>
    </div>
    <div class="syss"><div class="sysdot"></div><span class="syslabel">üî• SISTEM AKTIF ‚Äî LIVE</span></div>
  </div>
</nav>

<!-- TOPBAR -->
<header class="topbar">
  <div class="tcrumb">TVTOTO OPS / <em id="plabel">Dashboard</em></div>
  <div class="spacer"></div>
  <div class="tclock" id="clk">00:00:00</div>
  <div class="vdiv"></div>
  <div class="tdb"><div class="d1" id="tdate">‚Äî</div><div class="d2" id="tday">‚Äî</div></div>
  <div class="vdiv"></div>
  <button class="mbtn admin" id="mbtn" onclick="toggleMode()">üî• Admin</button>
  <div class="nbell" onclick="gp('history',document.querySelectorAll('.nitem')[7])">üîî<div class="npip" id="npip" style="display:none"></div></div>
</header>

<main class="main">

<!-- ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê -->
<div class="page active" id="page-dashboard">
  <div class="ph"><div class="ph-title">CAPTAIN <span>DASHBOARD</span></div><div class="ph-sub">Overview operasional staff ‚Äî monitoring real-time world class + Firebase Cloud Sync</div></div>
  <div class="stat-grid" style="grid-template-columns:repeat(3,1fr);">
    <div class="scard sc-gold"><div class="sc-glow"></div><div class="sc-ico">üë•</div><div class="sc-label">Staff Aktif</div><div class="sc-val" id="s-aktif">0</div><div class="sc-meta">Terdaftar hari ini</div></div>
    <div class="scard sc-cyan"><div class="sc-glow"></div><div class="sc-ico">‚è±</div><div class="sc-label">Total Shift</div><div class="sc-val" id="s-shift">0</div><div class="sc-meta">Shift dijadwalkan</div></div>
    <div class="scard sc-green"><div class="sc-glow"></div><div class="sc-ico">‚úÖ</div><div class="sc-label">Sedang Kerja</div><div class="sc-val" id="s-kerja">0</div><div class="sc-meta">Shift berlangsung</div></div>
    <div class="scard sc-rose"><div class="sc-glow"></div><div class="sc-ico">üé≤</div><div class="sc-label">Jobdesk Aktif</div><div class="sc-val" id="s-jd">0</div><div class="sc-meta">Hasil distribusi</div></div>
    <div class="scard sc-line"><div class="sc-glow"></div><div class="sc-ico">üí¨</div><div class="sc-label">Absen LINE ‚úÖ</div><div class="sc-val" id="s-line-ok">0</div><div class="sc-meta">Tepat waktu di LINE</div></div>
    <div class="scard sc-rose"><div class="sc-glow"></div><div class="sc-ico">üö®</div><div class="sc-label">Sanksi LINE</div><div class="sc-val" id="s-line-sanksi">0</div><div class="sc-meta">Lewati batas :35</div></div>
  </div>
  <div class="g2">
    <div class="panel">
      <div class="phd"><div class="ptitle">üì° Status Shift Real-time</div><span class="pbadge cb">LIVE</span></div>
      <div class="pbd" id="dashShiftList"><div class="empty-red"><div class="eri">‚è≥</div><div class="ert">Belum ada data shift</div></div></div>
    </div>
    <div class="panel">
      <div class="phd"><div class="ptitle">‚ö° Quick Paste Shift</div><span class="pbadge">Auto Detect</span></div>
      <div class="pbd">
        <div class="fg" style="margin-bottom:10px;">
          <label class="fl">Pilih Role untuk Paste</label>
          <select class="fsel" id="quickPasteRole">
            <option value="KASIR">üí∞ KASIR (Jobdesk)</option>
            <option value="KAPTEN">üëÆ KAPTEN</option>
            <option value="CS">üéß CS (Customer Service)</option>
          </select>
        </div>
        <textarea class="pbox" id="quickPaste" placeholder="Paste format shift di sini...&#10;Contoh:&#10;PUTRI CAHAYA | 07:45 | 17:45&#10;JIMMY | 07:45 | 17:45&#10;RADO DINATA | 21:00 | 07:00"></textarea>
        <div class="pcorner"><button class="btn btn-ghost btn-sm" onclick="document.getElementById('quickPaste').value=''">Bersihkan</button><button class="btn btn-gold btn-sm" onclick="processPaste()">‚ö° Proses Auto</button></div>
      </div>
    </div>
  </div>
  <div class="panel">
    <div class="phd"><div class="ptitle">‚úÖ Checklist Kehadiran</div><span class="pbadge rb" id="checkBadge">0 Belum</span></div>
    <div class="pbd" id="checklistPanel"><div class="empty-red"><div class="eri">üìã</div><div class="ert">Tambah shift untuk melihat checklist</div></div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê ACAK JOBDESK ‚ïê‚ïê‚ïê -->
<div class="page" id="page-jobdesk-acak">
  <div class="ph"><div class="ph-title">Acak <span>Jobdesk</span></div><div class="ph-sub">Distribusi otomatis ‚Äî operator tetap, staff lain diacak</div></div>
  <div style="background:linear-gradient(135deg,rgba(196,18,48,.08),rgba(232,185,79,.04));border:1.5px solid rgba(196,18,48,.28);border-radius:var(--r1);padding:22px;margin-bottom:16px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--red),var(--gold),transparent);"></div>
    <div style="font-family:'Cinzel',serif;font-size:21px;font-weight:700;letter-spacing:.1em;background:linear-gradient(135deg,var(--gold-pale),var(--gold),var(--ember));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:5px;">üé≤ Sistem Acak Jobdesk</div>
    <div style="font-family:'Josefin Sans',sans-serif;font-size:12px;color:var(--t2);line-height:1.7;">Operator (3 per shift) ‚Üí jobdesk OPERATOR otomatis tetap. Staff lainnya (Khusus KASIR) ‚Üí diacak dari pool. <br/>Kapten & CS tidak akan masuk ke dalam jobdesk.</div>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:16px;">
      <div id="tab-ALL" class="shift-tab active" onclick="setTab('ALL')" style="padding:8px 16px;border-radius:var(--r2);border:1px solid rgba(196,18,48,.14);background:rgba(196,18,48,.13);color:var(--crimson);cursor:pointer;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;transition:all .2s;">Semua Shift</div>
      <div id="tab-PAGI" class="shift-tab" onclick="setTab('PAGI')" style="padding:8px 16px;border-radius:var(--r2);border:1px solid rgba(196,18,48,.12);background:rgba(20,2,4,.8);color:var(--t2);cursor:pointer;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;transition:all .2s;">üåÖ Pagi</div>
      <div id="tab-SORE" class="shift-tab" onclick="setTab('SORE')" style="padding:8px 16px;border-radius:var(--r2);border:1px solid rgba(196,18,48,.12);background:rgba(20,2,4,.8);color:var(--t2);cursor:pointer;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;transition:all .2s;">üå§ Sore</div>
      <div id="tab-MALAM" class="shift-tab" onclick="setTab('MALAM')" style="padding:8px 16px;border-radius:var(--r2);border:1px solid rgba(196,18,48,.12);background:rgba(20,2,4,.8);color:var(--t2);cursor:pointer;font-family:'Josefin Sans',sans-serif;font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;transition:all .2s;">üåô Malam</div>
      <button class="btn-rnd" onclick="runRandom()" id="rndBtn"><span class="dice-ico">üé≤</span><span>Acak Jobdesk</span></button>
      <button class="btn btn-ghost btn-sm" onclick="copyResult()">üìã Copy</button>
      <button class="btn btn-ghost btn-sm" onclick="clearResult()">üóë Clear</button>
    </div>
  </div>
  <div class="g2">
    <div class="panel"><div class="phd"><div class="ptitle">üíº Pool Jobdesk</div><span class="pbadge cb">Input</span></div><div class="pbd"><textarea class="fta" id="jobdeskPool" style="min-height:160px;" placeholder="SCATTER&#10;WD DANA&#10;WD MANDIRI, BNI&#10;DEPO BCA&#10;..."></textarea><div style="display:flex;gap:9px;flex-wrap:wrap;margin-top:12px;"><button class="btn btn-ghost btn-sm" onclick="loadSampleJD()">üìã Contoh</button><button class="btn btn-cyan btn-sm" onclick="savePool()">üíæ Simpan</button></div></div></div>
    <div class="panel"><div class="phd"><div class="ptitle">üëë Operator Per Shift</div><span class="pbadge vb">Fixed</span></div><div class="pbd"><div style="font-family:'Josefin Sans',sans-serif;font-size:12px;color:var(--t2);margin-bottom:13px;">Nama berikut mendapat jobdesk <span class="op-tag"><span>üëë</span>OPERATOR</span> otomatis.</div><div id="opSummaryList"><div class="empty-red" style="padding:18px;"><div class="eri">üëë</div><div class="ert">Belum ada operator diset</div></div></div><div style="margin-top:12px;"><button class="btn btn-violet btn-sm" onclick="gp('operator',document.querySelectorAll('.nitem')[2])">‚öô Setting ‚Üí</button></div></div></div>
  </div>
  <div class="panel" id="resultPanel" style="display:none;"><div class="phd"><div class="ptitle">üìä Hasil Distribusi</div><span class="pbadge" id="resultShiftLabel">‚Äî</span><span class="pbadge cb" id="resultCount">0 Staff</span></div><div class="tbl-wrap"><table class="tbl" style="width:100%;border-collapse:collapse;"><thead><tr><th style="padding:11px 16px;text-align:left;font-family:'Josefin Sans',sans-serif;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;">#</th><th style="padding:11px 16px;text-align:left;font-family:'Josefin Sans',sans-serif;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;">Nama Staff</th><th style="padding:11px 16px;text-align:left;font-family:'Josefin Sans',sans-serif;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;">Shift</th><th style="padding:11px 16px;text-align:left;font-family:'Josefin Sans',sans-serif;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;">Jam</th><th style="padding:11px 16px;text-align:left;font-family:'Josefin Sans',sans-serif;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;">Jobdesk</th><th style="padding:11px 16px;text-align:left;font-family:'Josefin Sans',sans-serif;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:rgba(255,140,100,.5);border-bottom:1px solid rgba(196,18,48,.16);font-weight:700;">Tipe</th></tr></thead><tbody id="resultTB"></tbody></table></div></div>
  <div id="resultEmpty" class="panel"><div class="pbd"><div class="empty-red"><div class="eri">üé≤</div><div class="ert">Klik Acak Jobdesk untuk mendistribusikan</div></div></div></div>
</div>

<!-- ‚ïê‚ïê‚ïê OPERATOR ‚ïê‚ïê‚ïê -->
<div class="page" id="page-operator">
  <div class="ph"><div class="ph-title">Setting <span>Operator</span></div><div class="ph-sub">Set 3 operator tetap per shift ‚Äî mereka selalu mendapat jobdesk OPERATOR</div></div>
  <div style="display:flex;flex-direction:column;gap:20px;">
    <div class="panel"><div class="phd"><div class="ptitle">üåÖ Operator Shift Pagi</div><span class="pbadge">3 Slot</span></div><div class="pbd"><div class="op-grid"><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">1</div>Op 1 ‚Äî Pagi</div><input class="fi" id="op-pagi-1" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">2</div>Op 2 ‚Äî Pagi</div><input class="fi" id="op-pagi-2" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">3</div>Op 3 ‚Äî Pagi</div><input class="fi" id="op-pagi-3" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div></div></div></div>
    <div class="panel"><div class="phd"><div class="ptitle">üå§ Operator Shift Sore</div><span class="pbadge">3 Slot</span></div><div class="pbd"><div class="op-grid"><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">1</div>Op 1 ‚Äî Sore</div><input class="fi" id="op-sore-1" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">2</div>Op 2 ‚Äî Sore</div><input class="fi" id="op-sore-2" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">3</div>Op 3 ‚Äî Sore</div><input class="fi" id="op-sore-3" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div></div></div></div>
    <div class="panel"><div class="phd"><div class="ptitle">üåô Operator Shift Malam</div><span class="pbadge">3 Slot</span></div><div class="pbd"><div class="op-grid"><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">1</div>Op 1 ‚Äî Malam</div><input class="fi" id="op-malam-1" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">2</div>Op 2 ‚Äî Malam</div><input class="fi" id="op-malam-2" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div><div class="op-slot"><div class="op-slot-label"><div class="op-slot-num">3</div>Op 3 ‚Äî Malam</div><input class="fi" id="op-malam-3" type="text" placeholder="Nama operator‚Ä¶" list="staffDL"></div></div></div></div>
    <datalist id="staffDL"></datalist>
    <div style="display:flex;gap:11px;flex-wrap:wrap;"><button class="btn btn-gold" onclick="saveOperators()">üíæ Simpan Setting</button><button class="btn btn-ghost" onclick="clearOperators()">üóë Hapus Semua</button><button class="btn btn-cyan" onclick="gp('jobdesk-acak',document.querySelectorAll('.nitem')[1])">üé≤ Ke Acak Jobdesk ‚Üí</button></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SHIFT ‚ïê‚ïê‚ïê -->
<div class="page" id="page-shift">
  <div class="ph"><div class="ph-title">Manajemen <span>Shift</span></div><div class="ph-sub">Input & kelola jadwal shift seluruh staff</div></div>
  <div class="g2">
    <div class="panel"><div class="phd"><div class="ptitle">‚ûï Input Manual</div><span class="pbadge">Form</span></div><div class="pbd">
      <div class="fr2">
        <div class="fg"><label class="fl">Nama Staff</label><input class="fi" id="sh-name" type="text" placeholder="Nama‚Ä¶" list="staffDL"></div>
        <div class="fg"><label class="fl">Tanggal</label><input class="fi" id="sh-date" type="date"></div>
      </div>
      <div class="fr3">
        <div class="fg"><label class="fl">Role / Posisi</label>
          <select class="fsel" id="sh-role">
            <option value="KASIR">üí∞ KASIR (Jobdesk)</option>
            <option value="KAPTEN">üëÆ KAPTEN</option>
            <option value="CS">üéß CS (Customer Service)</option>
          </select>
        </div>
        <div class="fg"><label class="fl">Jam Mulai</label><input class="fi" id="sh-start" type="time" oninput="calcH()"></div>
        <div class="fg"><label class="fl">Jam Selesai</label><input class="fi" id="sh-end" type="time" oninput="calcH()"></div>
      </div>
      <div class="fr2">
        <div class="fg"><label class="fl">Tipe Shift</label><select class="fsel" id="sh-type"><option value="PAGI">üåÖ PAGI</option><option value="SORE">üå§ SORE</option><option value="MALAM">üåô MALAM</option><option value="GANTUNG">‚õì GANTUNG</option><option value="CUSTOM">‚öô CUSTOM</option></select></div>
        <div class="fg"><label class="fl">Keterangan / Total</label><div class="total-h" id="sh-total" style="font-size:12px;">‚Äî jam</div></div>
      </div>
      <div class="fg"><label class="fl">Catatan Tambahan</label><input class="fi" id="sh-note" type="text" placeholder="Catatan‚Ä¶"></div>
      <button class="btn btn-gold btn-full" onclick="addShift()">‚ûï Tambah Shift</button>
    </div></div>
    <div class="panel"><div class="phd"><div class="ptitle">üì• Paste Import</div><span class="pbadge">Auto Import</span></div><div class="pbd"><div style="font-family:'JetBrains Mono',monospace;font-size:10.5px;color:rgba(200,110,90,.7);background:rgba(24,3,5,.8);border:1px solid rgba(196,18,48,.11);padding:11px 13px;border-radius:var(--r2);line-height:2;margin-bottom:12px;">Format: NAMA | HH:mm | HH:mm | KET<br/>Default Role: KASIR (bisa diedit)</div><textarea class="pbox" id="shiftPaste" style="min-height:160px;" placeholder="PUTRI CAHAYA | 07:45 | 17:45 | 12 JAM&#10;JIMMY | 07:45 | 17:45 | 10 JAM&#10;RADO DINATA | 21:00 | 07:00 | 10 JAM"></textarea><div class="pcorner"><button class="btn btn-ghost btn-sm" onclick="document.getElementById('shiftPaste').value=''">Hapus</button><button class="btn btn-cyan btn-sm" onclick="importPaste()">üì• Import</button></div></div></div>
  </div>
  <div class="panel"><div class="phd"><div class="ptitle">üìä Daftar Shift</div><span class="pbadge" id="shiftCount">0 Shift</span></div><div class="tbl-ctrl"><div class="sbox"><span class="sico">üîç</span><input type="text" placeholder="Cari nama‚Ä¶" oninput="filterST(this.value)"></div><select class="fsel2" onchange="filterSTtype(this.value)"><option value="">Semua Tipe</option><option value="PAGI">Pagi</option><option value="SORE">Sore</option><option value="MALAM">Malam</option></select><button class="btn btn-rose btn-sm" onclick="if(confirm('Hapus semua?')){shifts=[];fbSaveAll();renderAll();toast('Dihapus','warn');}">üóë Hapus Semua</button></div><div class="tbl-wrap"><table class="tbl"><thead><tr><th>#</th><th>Nama</th><th>Role</th><th>Tipe</th><th>Mulai</th><th>Selesai</th><th>Total</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="shiftTB"></tbody></table></div></div>
</div>

<!-- ‚ïê‚ïê‚ïê MONITOR ‚ïê‚ïê‚ïê -->
<div class="page" id="page-monitor">
  <div class="ph"><div class="ph-title">Monitor <span>Real-time</span></div><div class="ph-sub">Pantau seluruh status staff secara langsung</div></div>
  <div class="panel"><div class="phd"><div class="ptitle">üì° Staff Monitoring Board</div><span class="pbadge cb">LIVE</span></div><div class="tbl-ctrl"><div class="sbox"><span class="sico">üîç</span><input type="text" placeholder="Cari staff‚Ä¶" oninput="filterMon(this.value)"></div><select class="fsel2" onchange="filterMonStatus(this.value)"><option value="">Semua Status</option><option value="AKTIF">üü¢ Aktif</option><option value="BELUM">üî¥ Belum</option><option value="SELESAI">‚¨ú Selesai</option></select><button class="btn btn-cyan btn-sm" onclick="refreshMon()">üîÑ Refresh</button></div><div class="tbl-wrap"><table class="tbl"><thead><tr><th>#</th><th>Nama</th><th>Role</th><th>Tipe</th><th>Jam</th><th>Total</th><th>Jobdesk</th><th>Status</th><th>Progress</th></tr></thead><tbody id="monTB"></tbody></table></div></div>
</div>

<!-- ‚ïê‚ïê‚ïê ABSENSI REGULER ‚ïê‚ïê‚ïê -->
<div class="page" id="page-absen">
  <div class="ph"><div class="ph-title">Absensi <span>Staff</span></div><div class="ph-sub">Rekam kehadiran real-time ‚Äî deteksi keterlambatan otomatis & laporan instan</div></div>
  <div class="absen-hero">
    <div class="asc asc-late"><div class="asc-shine"></div><div class="asc-bar"></div><div class="asc-icon">üî¥</div><div class="asc-val" id="al-count">0</div><div class="asc-label">Staff Terlambat</div></div>
    <div class="asc asc-ok"><div class="asc-shine"></div><div class="asc-bar"></div><div class="asc-icon">‚úÖ</div><div class="asc-val" id="ao-count">0</div><div class="asc-label">Tepat Waktu</div></div>
    <div class="asc asc-pend"><div class="asc-shine"></div><div class="asc-bar"></div><div class="asc-icon">‚è≥</div><div class="asc-val" id="ap-count">0</div><div class="asc-label">Belum Absen</div></div>
  </div>
  <div class="atabs">
    <button class="atab active" id="atab-ALL" onclick="setAbsenTab('ALL')">‚¨° Semua</button>
    <button class="atab" id="atab-PAGI" onclick="setAbsenTab('PAGI')">üåÖ Pagi</button>
    <button class="atab" id="atab-SORE" onclick="setAbsenTab('SORE')">üå§ Sore</button>
    <button class="atab" id="atab-MALAM" onclick="setAbsenTab('MALAM')">üåô Malam</button>
  </div>
  <div class="absen-layout">
    <div class="absen-ipanel">
      <div class="aphd"><div class="aphd-title"><div class="aphd-ico">üïê</div>Input Jam Masuk</div><span style="font-family:'Josefin Sans',sans-serif;font-size:9.5px;font-weight:700;letter-spacing:.14em;background:rgba(0,245,212,.06);color:#00f5d4;border:1px solid rgba(0,245,212,.16);padding:3px 11px;border-radius:20px;text-transform:uppercase;" id="absen-total-badge">0 Staff</span></div>
      <div class="tolbanner"><div class="tol-ico">‚ö†</div><div class="tol-txt">Batas toleransi ‚Äî masuk setelah menit <strong>:45</strong> dinyatakan <strong style="color:var(--crimson);">TERLAMBAT</strong></div><div class="tol-time">HH:45:00</div></div>
      <div class="staff-list" id="absenTableWrap"><div class="empty-red"><div class="eri">üïê</div><div class="ert">Belum ada data shift</div></div></div>
      <div class="atbar"><button class="btn-now" onclick="setAllNow()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Jam Sekarang</button><button class="btn-hadall" onclick="setAllNow()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>Hadir Semua</button><button class="btn-simp" onclick="saveAllAbsen()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>Simpan</button></div>
    </div>
    <div class="late-rpanel">
      <div class="lrphd">
        <div class="lrptitle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--crimson)" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Laporan Keterlambatan</div>
        <button class="btn-copyall" onclick="copyAllLateReports()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy Semua</button>
      </div>
      <div class="late-list" id="lateReportsList"><div class="empty-red" style="padding:44px 20px;"><div class="eri">‚úÖ</div><div class="ert">Semua staff tepat waktu</div></div></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê ABSENSI LINE ‚ïê‚ïê‚ïê -->
<div class="page" id="page-absen-line">
  <div class="ph"><div class="ph-title">Absensi <span>LINE</span></div><div class="ph-sub">Monitor absensi via LINE ‚Äî deteksi deadline per shift, sanksi otomatis</div></div>
  <div class="absen-hero">
    <div class="asc asc-late"><div class="asc-shine"></div><div class="asc-bar"></div><div class="asc-icon">üö®</div><div class="asc-val" id="la-sanksi-count">0</div><div class="asc-label">Sanksi</div></div>
    <div class="asc asc-ok"><div class="asc-shine"></div><div class="asc-bar"></div><div class="asc-icon">‚úÖ</div><div class="asc-val" id="la-ok-count">0</div><div class="asc-label">Tepat Waktu</div></div>
    <div class="asc asc-pend"><div class="asc-shine"></div><div class="asc-bar"></div><div class="asc-icon">‚ö†</div><div class="asc-val" id="la-telat-count">0</div><div class="asc-label">Telat</div></div>
  </div>
  <div class="atabs">
    <button class="atab active" id="latab-ALL" onclick="setLineTab('ALL')">‚¨° Semua</button>
    <button class="atab" id="latab-PAGI" onclick="setLineTab('PAGI')">üåÖ Pagi</button>
    <button class="atab" id="latab-SORE" onclick="setLineTab('SORE')">üå§ Sore</button>
    <button class="atab" id="latab-MALAM" onclick="setLineTab('MALAM')">üåô Malam</button>
  </div>
  <div class="absen-layout">
    <div class="absen-ipanel">
      <div class="aphd"><div class="aphd-title"><div class="aphd-ico">üí¨</div>Input Absen LINE</div><span style="font-family:'Josefin Sans',sans-serif;font-size:9.5px;font-weight:700;letter-spacing:.14em;background:rgba(6,199,85,.06);color:var(--line-green);border:1px solid rgba(6,199,85,.16);padding:3px 11px;border-radius:20px;text-transform:uppercase;" id="line-total-badge">0 Staff</span></div>
      <div class="tolbanner" style="background:rgba(232,185,79,.06);border-color:rgba(232,185,79,.15);"><div class="tol-ico" style="color:var(--gold);">‚ö†</div><div class="tol-txt"><strong>DEADLINE:</strong> Menit :35. <strong>TELAT:</strong> :36-:45. <strong style="color:var(--crimson);">SANKSI:</strong> > :45</div></div>
      <div class="staff-list" id="lineAbsenTableWrap"><div class="empty-red"><div class="eri">üí¨</div><div class="ert">Belum ada data shift</div></div></div>
      <div class="atbar"><button class="btn-now" onclick="setLineAllNow()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Set Sekarang</button><button class="btn-simp" onclick="saveAllLine()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>Simpan</button></div>
    </div>
    <div class="late-rpanel line-report-panel">
      <div class="lrphd" style="background:linear-gradient(90deg,rgba(6,199,85,.08),transparent);"><div class="lrptitle" style="color:var(--line-green);"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Laporan Sanksi LINE</div><button class="btn-copyall" onclick="copyLineSanksiReports()" style="color:var(--line-green);border-color:rgba(6,199,85,.3);"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy Sanksi</button></div>
      <div class="late-list" id="lineReportsList"><div class="empty-red" style="padding:44px 20px;"><div class="eri">‚úÖ</div><div class="ert">Tidak ada sanksi</div></div></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê HISTORY & LOG ‚ïê‚ïê‚ïê -->
<div class="page" id="page-history">
  <div class="ph"><div class="ph-title">System <span>Logs</span></div><div class="ph-sub">Riwayat aktivitas sistem</div></div>
  <div class="panel">
    <div class="phd"><div class="ptitle">üóÇ Log Aktivitas</div><span class="pbadge" id="histCount">0 Entri</span></div>
    <div class="pbd" style="max-height:600px;overflow-y:auto;" id="histLog"><div class="empty-red"><div class="eri">üóÇ</div><div class="ert">Log kosong</div></div></div>
    <div class="tbl-ctrl" style="justify-content:center;border-top:1px solid rgba(196,18,48,.09);background:none;"><button class="btn btn-rose" onclick="clearHist()">üóë Bersihkan History</button></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê EXPORT ‚ïê‚ïê‚ïê -->
<div class="page" id="page-export">
  <div class="ph"><div class="ph-title">Export <span>Data</span></div><div class="ph-sub">Unduh laporan dalam format CSV/JSON</div></div>
  <div class="g2">
    <div class="panel"><div class="phd"><div class="ptitle">üìä Data Shift</div></div><div class="pbd"><div style="background:rgba(0,0,0,.3);padding:10px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--t2);margin-bottom:12px;white-space:pre-wrap;height:120px;overflow-y:auto;" id="expShiftPrev"></div><div style="display:flex;gap:8px;"><button class="btn btn-gold btn-sm" onclick="expCSV('shift')">Download CSV</button><button class="btn btn-ghost btn-sm" onclick="expJSON('shift')">JSON</button><button class="btn btn-cyan btn-sm" onclick="printTbl('shift')">üñ® Print</button></div></div></div>
    <div class="panel"><div class="phd"><div class="ptitle">üé≤ Hasil Jobdesk</div></div><div class="pbd"><div style="background:rgba(0,0,0,.3);padding:10px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--t2);margin-bottom:12px;white-space:pre-wrap;height:120px;overflow-y:auto;" id="expResultPrev"></div><div style="display:flex;gap:8px;"><button class="btn btn-gold btn-sm" onclick="expCSV('result')">Download CSV</button><button class="btn btn-ghost btn-sm" onclick="expJSON('result')">JSON</button><button class="btn btn-cyan btn-sm" onclick="printTbl('result')">üñ® Print</button></div></div></div>
    <div class="panel"><div class="phd"><div class="ptitle">üí¨ Laporan LINE</div></div><div class="pbd"><div style="display:flex;gap:8px;flex-wrap:wrap;"><button class="btn btn-line btn-sm" onclick="exportLineCSV()">Download CSV</button><button class="btn btn-cyan btn-sm" onclick="printLineReport()">üñ® Print Laporan</button><button class="btn btn-ghost btn-sm" onclick="copyLineAll()">üìã Copy Text</button></div></div></div>
  </div>
</div>

</main>
</div>

<!-- ‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB...",
  authDomain: "tvtoto-ops.firebaseapp.com",
  databaseURL: "https://tvtoto-ops-default-rtdb.firebaseio.com",
  projectId: "tvtoto-ops",
  storageBucket: "tvtoto-ops.appspot.com",
  messagingSenderId: "367...",
  appId: "1:367..."
};

let app, db;
try {
  app = initializeApp(firebaseConfig);
  db = getDatabase(app);
} catch(e) { console.warn('Firebase init error', e); }

function startFirebaseListeners() {
  if(!db) return;
  const refs = [
    { key: 'shifts', path: 'tvtoto/shifts', target: 'shifts' },
    { key: 'hist', path: 'tvtoto/hist', target: 'hist' },
    { key: 'checked', path: 'tvtoto/checked', target: 'checked' },
    { key: 'operators', path: 'tvtoto/operators', target: 'operators' },
    { key: 'jdPool', path: 'tvtoto/jdPool', target: 'jdPool' },
    { key: 'lastResult', path: 'tvtoto/lastResult', target: 'lastResult' },
    { key: 'absenData', path: 'tvtoto/absenData', target: 'absenData' },
    { key: 'lineAbsenData', path: 'tvtoto/lineAbsenData', target: 'lineAbsenData' }
  ];

  refs.forEach(({ key, path, target }) => {
    onValue(ref(db, path), (snap) => {
      const val = snap.val();
      if(val) {
        if(key === 'hist' || key === 'jdPool' || key === 'checked' || key === 'shifts' || key === 'lastResult') {
          // Konversi object ke array jika perlu
          window[target] = Array.isArray(val) ? val : Object.values(val);
        } else {
          window[target] = val;
        }
        window.renderAll && window.renderAll();
      }
    });
  });

  const connectedRef = ref(db, ".info/connected");
  onValue(connectedRef, (snap) => {
    if (snap.val() === true) {
      window.setFbStatus && window.setFbStatus('online', '‚òÅ Cloud Sync Aktif');
    } else {
      window.setFbStatus && window.setFbStatus('offline', '‚ö† Offline Mode');
    }
  });
}

// ‚îÄ‚îÄ‚îÄ UTILS Firebase ‚îÄ‚îÄ‚îÄ
function arrToObj(arr) {
  if(!Array.isArray(arr)) return arr;
  const obj = {};
  arr.forEach((item, i) => { obj['k'+i] = item; });
  return obj;
}

// Global functions for main script
window.setFbStatus = function(status, text) {
  const el = document.getElementById('fb-status');
  const txt = document.getElementById('fb-status-text');
  if(el && txt) {
    el.className = `fb-status ${status}`;
    txt.textContent = text;
  }
};

window.fbSaveShifts = async function() {
  try {
    const obj = arrToObj(window.shifts || []);
    await set(ref(db, 'tvtoto/shifts'), obj);
  } catch(e) {
    console.error('fbSaveShifts error:', e);
    window.setFbStatus('offline', '‚ùå ' + (e.code || 'Gagal'));
    window.localSave && window.localSave();
  }
};

window.fbSaveResult = async function() {
  try {
    const obj = arrToObj(window.lastResult || []);
    await set(ref(db, 'tvtoto/lastResult'), obj);
  } catch(e) { console.error('fbSaveResult error:', e); }
};

window.fbSaveHist = async function() {
  try {
    const arr = (window.hist || []).slice(0, 100);
    const obj = {};
    arr.forEach((item, i) => { obj['h' + i] = item; });
    await set(ref(db, 'tvtoto/hist'), obj);
  } catch(e) { console.error('fbSaveHist error:', e); }
};

window.fbSavePool = async function() {
  try {
    const obj = {};
    (window.jdPool || []).forEach((item, i) => { obj['p' + i] = item; });
    await set(ref(db, 'tvtoto/jdPool'), obj);
  } catch(e) { console.error('fbSavePool error:', e); }
};

window.fbSaveChecked = async function() {
  try {
    const obj = {};
    (window.checked || []).forEach((item, i) => { obj['c' + i] = item; });
    await set(ref(db, 'tvtoto/checked'), obj);
  } catch(e) { console.error('fbSaveChecked error:', e); }
};

window.fbSaveNode = async function(node, data) {
  window.setFbStatus('syncing', 'üîÑ Syncing...');
  try {
    await set(ref(db, 'tvtoto/' + node), data);
    window.setFbStatus('online', '‚òÅ Cloud Sync Aktif');
  } catch(e) {
    console.error('fbSaveNode error:', e);
    window.setFbStatus('offline', '‚ùå ' + (e.code || 'Gagal'));
  }
};

window.fbSaveAll = async function() {
  window.setFbStatus('syncing', 'üîÑ Menyimpan semua...');
  try {
    await Promise.all([
      set(ref(db, 'tvtoto/shifts'), arrToObj(window.shifts||[])),
      set(ref(db, 'tvtoto/absenData'), window.absenData||{}),
      set(ref(db, 'tvtoto/lineAbsenData'), window.lineAbsenData||{}),
      set(ref(db, 'tvtoto/operators'), window.operators||{pagi:['','',''],sore:['','',''],malam:['','','']}),
      set(ref(db, 'tvtoto/lastResult'), arrToObj(window.lastResult||[])),
    ]);
    window.setFbStatus('online', '‚òÅ Semua Tersimpan');
  } catch(e) {
    console.error('fbSaveAll error:', e);
    window.setFbStatus('offline', '‚ùå Gagal Sync');
    window.localSave && window.localSave();
  }
};

// Start listening
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', startFirebaseListeners);
} else {
  startFirebaseListeners();
}
</script>

<!-- ‚ïê‚ïê‚ïê MAIN APP SCRIPT ‚ïê‚ïê‚ïê -->
<script>
// ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê
const ACCS={
  'admin':{password:'tvtoto2024',role:'Administrator',display:'ADMIN'},
  'captain':{password:'captain123',role:'Captain',display:'CAPTAIN'},
  'manager':{password:'mgr2024',role:'Manager',display:'MANAGER'},
  'ops':{password:'ops1234',role:'Operator',display:'OPS'}
};
let currentUser=JSON.parse(sessionStorage.getItem('tvtoto_u')||'null');

function spawnParticles(){
  const c=document.getElementById('lp-wrap');
  for(let i=0;i<28;i++){const p=document.createElement('div');p.className='lp';p.style.cssText=`left:${Math.random()*100}%;width:${1+Math.random()*2}px;height:${1+Math.random()*2}px;animation-duration:${4+Math.random()*8}s;animation-delay:${-Math.random()*10}s;background:${Math.random()>.5?'var(--gold)':'var(--crimson)'};`;c.appendChild(p);}
}
function toggleEye(){const i=document.getElementById('lp');i.type=i.type==='password'?'text':'password';document.getElementById('leye').textContent=i.type==='password'?'üëÅ':'üôà';}
function doLogin(){
  const u=document.getElementById('lu').value.trim().toLowerCase(),p=document.getElementById('lp').value;
  const e=document.getElementById('lerr'),btn=document.getElementById('lbtn'),txt=document.getElementById('lbtxt'),sp=document.getElementById('lspin');
  e.classList.remove('show');
  if(!u||!p){document.getElementById('lerr-msg').textContent='Username & password wajib diisi.';e.classList.add('show');return;}
  txt.style.display='none';sp.style.display='block';btn.disabled=true;
  setTimeout(()=>{
    const acc=ACCS[u];
    if(!acc||acc.password!==p){
      txt.style.display='flex';sp.style.display='none';btn.disabled=false;
      document.getElementById('lerr-msg').textContent='Username atau password salah.';e.classList.add('show');
      document.getElementById('lp').value='';
      const card=document.querySelector('.login-card');card.style.animation='shake .4s ease';setTimeout(()=>card.style.animation='',500);
      return;
    }
    currentUser={username:u,...acc};sessionStorage.setItem('tvtoto_u',JSON.stringify(currentUser));
    txt.style.display='flex';sp.style.display='none';btn.disabled=false;
    enterDash();
  },900);
}
function enterDash(){
  document.getElementById('login-screen').classList.add('fade-out');
  document.getElementById('app').classList.add('visible');
  document.getElementById('sbn').textContent=currentUser.display;
  document.getElementById('sbr').textContent=currentUser.role;
  document.getElementById('sbav').textContent=currentUser.display.charAt(0);
  addH('login',`Login: ${currentUser.display} (${currentUser.role})`,'var(--gold)');
  toast(`Selamat datang, ${currentUser.display}! üî•`);
}
function confirmLogout(){if(confirm('Logout dari TVTOTO OPS?')){sessionStorage.removeItem('tvtoto_u');document.getElementById('login-screen').classList.remove('fade-out');document.getElementById('app').classList.remove('visible');document.getElementById('lu').value='';document.getElementById('lp').value='';document.getElementById('lerr').classList.remove('show');currentUser=null;toast('Berhasil logout','info');}}

// ‚ïê‚ïê‚ïê STATE (global, diisi oleh Firebase listener) ‚ïê‚ïê‚ïê
let shifts=[];
let hist=[];
let checked=[];
let operators={pagi:['','',''],sore:['','',''],malam:['','','']};
let jdPool=[];
let lastResult=[];
let absenData={};
let lineAbsenData={};
let isAdmin=true,stSearch='',stType='',monSearch='',monStat='',activeTab='ALL',lineTab='ALL',absenTab='ALL';

// ‚îÄ‚îÄ‚îÄ LocalStorage fallback ‚îÄ‚îÄ‚îÄ
function localSave(){
  try{
    localStorage.setItem('nx_shifts',JSON.stringify(shifts));
    localStorage.setItem('nx_hist',JSON.stringify(hist));
    localStorage.setItem('nx_checked',JSON.stringify(checked));
    localStorage.setItem('nx_operators',JSON.stringify(operators));
    localStorage.setItem('nx_jdpool',JSON.stringify(jdPool));
    localStorage.setItem('nx_lastresult',JSON.stringify(lastResult));
    localStorage.setItem('nx_absen',JSON.stringify(absenData));
    localStorage.setItem('nx_line_absen',JSON.stringify(lineAbsenData));
  }catch(e){console.warn('LocalStorage save failed',e);}
}
window.localSave = localSave;

function save(){
  localSave();
}

// ‚îÄ‚îÄ‚îÄ Unified save dengan debounce ‚îÄ‚îÄ‚îÄ
let saveTimers={};
function debounceSave(node,data){
  clearTimeout(saveTimers[node]);
  saveTimers[node]=setTimeout(()=>{
    if(node==='shifts')        { if(window.fbSaveShifts)  window.fbSaveShifts();  else localSave(); }
    else if(node==='jdPool')   { if(window.fbSavePool)    window.fbSavePool();    else localSave(); }
    else if(node==='hist')     { if(window.fbSaveHist)    window.fbSaveHist();    else localSave(); }
    else if(node==='checked')  { if(window.fbSaveChecked) window.fbSaveChecked(); else localSave(); }
    else if(node==='lastResult'){ if(window.fbSaveResult) window.fbSaveResult();  else localSave(); }
    else { if(window.fbSaveNode) window.fbSaveNode(node,data); else localSave(); }
  },800);
}

window.onload=()=>{
  spawnParticles();tick();setInterval(tick,1000);setInterval(refreshMon,30000);setInterval(updateLineCountdown,1000);
  document.getElementById('sh-date').value=todayS();
  
  shifts=JSON.parse(localStorage.getItem('nx_shifts')||'[]');
  hist=JSON.parse(localStorage.getItem('nx_hist')||'[]');
  checked=JSON.parse(localStorage.getItem('nx_checked')||'[]');
  operators=JSON.parse(localStorage.getItem('nx_operators')||'{"pagi":["","",""],"sore":["","",""],"malam":["","",""]}');
  jdPool=JSON.parse(localStorage.getItem('nx_jdpool')||'[]');
  lastResult=JSON.parse(localStorage.getItem('nx_lastresult')||'[]');
  absenData=JSON.parse(localStorage.getItem('nx_absen')||'{}');
  lineAbsenData=JSON.parse(localStorage.getItem('nx_line_absen')||'{}');
  loadOpInputs();loadPoolInput();renderAll();
  if(lastResult.length)showResult(lastResult);
  if(currentUser)enterDash();
};

function todayS(){return new Date().toISOString().split('T')[0];}

// ‚ïê‚ïê‚ïê CLOCK ‚ïê‚ïê‚ïê
function tick(){
  const n=new Date(),p=v=>String(v).padStart(2,'0');
  document.getElementById('clk').textContent=`${p(n.getHours())}:${p(n.getMinutes())}:${p(n.getSeconds())}`;
  const days=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
  const months=['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'];
  document.getElementById('tdate').textContent=`${n.getDate()} ${months[n.getMonth()]} ${n.getFullYear()}`;
  document.getElementById('tday').textContent=`${days[n.getDay()]} ‚Äî WIB`;
}

// ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê
function gp(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nitem').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  if(el)el.classList.add('active');
  const L={dashboard:'Dashboard','jobdesk-acak':'Acak Jobdesk',operator:'Setting Operator',shift:'Manajemen Shift',monitor:'Monitor Real-time',absen:'Absensi Staff','absen-line':'Absensi LINE',history:'History Log',export:'Export Data'};
  document.getElementById('plabel').textContent=L[id]||id;
  if(id==='export')updateExpPrev();
  if(id==='monitor')refreshMon();
  if(id==='jobdesk-acak')renderOpSummary();
  if(id==='absen')renderAbsenTable();
  if(id==='absen-line'){renderLineTable();updateLineCountdown();}
  if(window.innerWidth<=960)document.getElementById('sidebar').classList.remove('open');
}
function toggleSb(){document.getElementById('sidebar').classList.toggle('open');}
function toggleMode(){isAdmin=!isAdmin;const b=document.getElementById('mbtn');b.textContent=isAdmin?'üî• Admin':'üë§ Staff';b.className='mbtn'+(isAdmin?' admin':'');toast('Mode: '+(isAdmin?'Admin':'Staff'),'info');}

// ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê
function toast(msg,type='ok'){
  const w=document.getElementById('tw'),t=document.createElement('div');
  t.className=`toast t-${type}`;t.innerHTML=`<span>${{ok:'‚úÖ',info:'üí°',warn:'‚ö†'}[type]}</span><span>${msg}</span>`;
  w.appendChild(t);setTimeout(()=>t.classList.add('show'),50);
  setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),400);},3000);
}

// ‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê
function calcH(){document.getElementById('sh-total').textContent=hrs(document.getElementById('sh-start').value,document.getElementById('sh-end').value);}
function hrs(s,e){if(!s||!e)return'‚Äî jam';let[sh,sm]=s.split(':').map(Number),[eh,em]=e.split(':').map(Number);let a=sh*60+sm,b=eh*60+em;if(b<=a)b+=1440;const d=b-a,h=Math.floor(d/60),m=d%60;return m?`${h}j ${m}m`:`${h} jam`;}
function hrsN(s,e){if(!s||!e)return 0;let[sh,sm]=s.split(':').map(Number),[eh,em]=e.split(':').map(Number);let a=sh*60+sm,b=eh*60+em;if(b<=a)b+=1440;return(b-a)/60;}
function shiftStatus(s){const n=new Date(),hm=n.getHours()*60+n.getMinutes();let[sh,sm]=s.start.split(':').map(Number),[eh,em]=s.end.split(':').map(Number);let a=sh*60+sm,b=eh*60+em;if(b<=a)b+=1440;if(hm>=a&&hm<b)return'AKTIF';if(hm>=b)return'SELESAI';return'BELUM';}
function shiftProg(s){const n=new Date(),hm=n.getHours()*60+n.getMinutes();let[sh,sm]=s.start.split(':').map(Number),[eh,em]=s.end.split(':').map(Number);let a=sh*60+sm,b=eh*60+em;if(b<=a)b+=1440;if(hm<a)return 0;if(hm>=b)return 100;return Math.round((hm-a)/(b-a)*100);}
function shiftBadge(t){const m={PAGI:'b-pagi',SORE:'b-sore',MALAM:'b-malam',GANTUNG:'b-malam',CUSTOM:'b-pending'};return`<span class="badge ${m[t]||'b-pagi'}">${t}</span>`;}
function statusBadge(st){if(st==='AKTIF')return`<span class="badge b-active"><span class="live-dot"></span>AKTIF</span>`;if(st==='SELESAI')return`<span class="badge b-done">SELESAI</span>`;return`<span class="badge b-pending">BELUM</span>`;}
function detectType(s){if(!s)return'CUSTOM';const h=parseInt(s.split(':')[0]);if(h>=6&&h<12)return'PAGI';if(h>=12&&h<18)return'SORE';return'MALAM';}
function pad2(n){return String(n).padStart(2,'0');}
function padToSec(ts){if(!ts||ts.trim()==='')return'';const p=ts.trim().split(':');if(p.length===2)return pad2(p[0])+':'+pad2(p[1])+':00';return pad2(p[0])+':'+pad2(p[1])+':'+(p[2]||'00').padStart(2,'0');}
function tsToSec(ts){if(!ts)return 0;const p=ts.trim().split(':');return(parseInt(p[0]||0)*3600)+(parseInt(p[1]||0)*60)+(parseInt(p[2]||0));}
function secsToHMS(s){const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),ss=s%60;if(h>0)return`${h}j ${m}m ${ss}d`;if(m>0)return`${m} menit${ss>0?' '+ss+' detik':''}`.trim();return`${ss} detik`;}
function fmtWIB(ts){if(!ts)return'‚Äî';const p=ts.trim().split(':');return`${pad2(p[0]||'00')}:${pad2(p[1]||'00')}:${pad2(p[2]||'00')} WIB`;}

// ‚ïê‚ïê‚ïê ABSENSI REGULER ‚ïê‚ïê‚ïê
function isLate(ss,ci){if(!ci||ci.trim()==='')return null;const[sh]=ss.split(':').map(Number);const dm=(sh*60+45)*60;return tsToSec(ci)>dm;}
function calcLateAmt(ss,ci){const[sh]=ss.split(':').map(Number);const ds=(sh*60+45)*60;const diff=tsToSec(ci)-ds;if(diff<=0)return null;return secsToHMS(diff);}
function genLateReport(s,a){const ci=padToSec(a.checkIn);const la=calcLateAmt(s.start,ci);const sid=(a.staffId||'').trim();const nd=sid?`${s.name} - ${sid}`:s.name;return`Info : TVTOTO\nPerihal : Telat hadir ke Office 15 menit lebih awal\nNama Staff : ${nd}\n\nJam Kerja : ${fmtWIB(s.start+':00')} - ${fmtWIB(s.end+':00')}\nMasuk Office pada jam : ${fmtWIB(ci)}  ( ${la} )`;}

function setAbsenTab(t){absenTab=t;document.querySelectorAll('.atab').forEach(x=>x.classList.remove('active'));document.getElementById('atab-'+t).classList.add('active');renderAbsenTable();}
function getAbsenShifts(){return absenTab==='ALL'?shifts:shifts.filter(s=>s.type===absenTab);}

function renderAbsenTable(){
  const data=getAbsenShifts();const wrap=document.getElementById('absenTableWrap');
  document.getElementById('absen-total-badge').textContent=`${data.length} Staff`;
  if(!data.length){wrap.innerHTML=`<div class="empty-red"><div class="eri">üïê</div><div class="ert">Belum ada data shift</div></div>`;updateAbsenStats();return;}
  const sc={PAGI:'var(--gold)',SORE:'#f97316',MALAM:'#c084fc',GANTUNG:'#c084fc',CUSTOM:'var(--t2)'};
  const sb={PAGI:'rgba(232,185,79,.1)',SORE:'rgba(249,115,22,.08)',MALAM:'rgba(168,85,247,.08)',GANTUNG:'rgba(168,85,247,.08)',CUSTOM:'rgba(150,140,180,.06)'};
  let html='';
  data.forEach((s,i)=>{
    const a=absenData[s.id]||{checkIn:'',staffId:'',saved:false};const ci=a.checkIn||'';const sid=a.staffId||'';
    const late=ci?isLate(s.start,padToSec(ci)):null;
    const cc=late===true?'is-late':late===false?'is-ok':'';
    const avc=late===true?'av-l':late===false?'av-o':'av-d';
    let sh;if(late===true)sh=`<span class="sp sp-late"><span class="spd"></span>TELAT</span>`;else if(late===false)sh=`<span class="sp sp-ok"><span class="spd"></span>TEPAT</span>`;else sh=`<span class="sp sp-belum"><span class="spd"></span>BELUM</span>`;
    const hd=ci&&ci.length>=5;const bc=hd?'hbtn hbtn-done':'hbtn hbtn-idle';
    const bi=`<svg class="hico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 12 9 17 20 7"/></svg>`;
    const color=sc[s.type]||'var(--t2)';const bg=sb[s.type]||'rgba(100,100,150,.06)';
    html+=`<div class="sacard ${cc}" id="absen-card-${s.id}" style="animation-delay:${i*.04}s">
      <div class="sa-av ${avc}">${s.name.charAt(0)}</div>
      <div class="sa-info"><div class="sa-name">${s.name}</div><div class="sa-meta"><span class="sa-sb" style="color:${color};background:${bg};border:1px solid ${color}33;">${s.type}</span><span>${s.start}‚Äì${s.end}</span></div></div>
      <input class="sa-id" type="text" id="sid-${s.id}" value="${sid}" placeholder="ID Staff" maxlength="12" oninput="setAbsenField('${s.id}','staffId',this.value)">
      <input class="sa-ti ${late===true?'t-late':late===false?'t-ok':''}" type="text" id="ci-${s.id}" value="${ci}" placeholder="HH:MM:SS" maxlength="8" oninput="onAbsenInput('${s.id}',this)" onblur="onAbsenBlur('${s.id}',this)">
      ${sh}
      <button class="${bc}" id="hbtn-${s.id}" onclick="doHadir('${s.id}')">${bi}</button>
    </div>`;
  });
  wrap.innerHTML=html;updateAbsenStats();renderLateReports();
}

function doHadir(key){
  const a=absenData[key]||{checkIn:'',staffId:'',saved:false};
  if(a.checkIn&&a.checkIn.length>=5){delete absenData[key];debounceSave('absenData',absenData);renderAbsenTable();toast('Absensi direset','warn');return;}
  const now=new Date();const ts=`${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;
  const el=document.getElementById(`ci-${key}`);if(el)el.value=ts;
  const se=document.getElementById(`sid-${key}`);absenData[key]={checkIn:ts,staffId:se?se.value:(a.staffId||''),saved:true};
  debounceSave('absenData',absenData);
  const btn=document.getElementById(`hbtn-${key}`);if(btn){btn.classList.add('hbtn-confirm');setTimeout(()=>btn.classList.remove('hbtn-confirm'),500);}
  renderAbsenTable();const s=shifts.find(s=>s.id===key);const iL=isLate((s||{}).start||'00:00',padToSec(ts));
  toast(s?`${s.name} ‚Äî ${iL?'‚ö† TERLAMBAT!':'‚úÖ Tepat waktu'}`:'Hadir dicatat',iL?'warn':'ok');
}

function onAbsenInput(key,el){
  let v=el.value.replace(/[^0-9]/g,'');if(v.length>2)v=v.slice(0,2)+':'+v.slice(2);if(v.length>5)v=v.slice(0,5)+':'+v.slice(5);if(v.length>8)v=v.slice(0,8);el.value=v;
  absenData[key]=absenData[key]||{checkIn:'',staffId:'',saved:false};absenData[key].checkIn=v;
  const s=shifts.find(s=>s.id===key);
  if(s&&v.length>=5){const l=isLate(s.start,padToSec(v));el.className=`sa-ti ${l===true?'t-late':l===false?'t-ok':''}`;const card=document.getElementById(`absen-card-${key}`);if(card)card.className=`sacard ${l===true?'is-late':l===false?'is-ok':''}`;}
}
function onAbsenBlur(key,el){const s=shifts.find(s=>s.id===key);if(!s||!el.value)return;absenData[key]=absenData[key]||{checkIn:'',staffId:'',saved:false};absenData[key].checkIn=el.value;debounceSave('absenData',absenData);updateAbsenStats();renderLateReports();}
function setAbsenField(key,field,val){absenData[key]=absenData[key]||{checkIn:'',staffId:'',saved:false};absenData[key][field]=val;}
function saveAllAbsen(){
  const data=getAbsenShifts();let saved=0;
  data.forEach(s=>{const el=document.getElementById(`ci-${s.id}`);const se=document.getElementById(`sid-${s.id}`);if(el&&el.value){absenData[s.id]=absenData[s.id]||{};absenData[s.id].checkIn=el.value;absenData[s.id].saved=true;if(se)absenData[s.id].staffId=se.value;saved++;}});
  if(window.fbSaveNode)window.fbSaveNode('absenData',absenData);else localSave();
  renderAbsenTable();addH('absen',`Absensi disimpan: ${saved} staff`,'var(--crimson)');toast(`${saved} absensi tersimpan! ‚òÅ Tersimpan ke Cloud`);
}
function setAllNow(){const now=new Date();const ts=`${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;getAbsenShifts().forEach(s=>{const el=document.getElementById(`ci-${s.id}`);if(el&&!el.value){el.value=ts;absenData[s.id]=absenData[s.id]||{checkIn:'',staffId:'',saved:false};absenData[s.id].checkIn=ts;}});debounceSave('absenData',absenData);renderAbsenTable();toast(`Jam ${ts} diisi ke yang belum`,'info');}

function updateAbsenStats(){
  const data=getAbsenShifts();let late=0,ok=0,pend=0;
  data.forEach(s=>{const a=absenData[s.id];if(!a||!a.checkIn){pend++;return;}const r=isLate(s.start,padToSec(a.checkIn));if(r===true)late++;else if(r===false)ok++;else pend++;});
  document.getElementById('al-count').textContent=late;document.getElementById('ao-count').textContent=ok;document.getElementById('ap-count').textContent=pend;
}

function renderLateReports(){
  const all=getAbsenShifts();const list=all.filter(s=>{const a=absenData[s.id];if(!a||!a.checkIn)return false;return isLate(s.start,padToSec(a.checkIn))===true;});
  const el=document.getElementById('lateReportsList');
  if(!list.length){el.innerHTML=`<div class="empty-red" style="padding:44px 20px;"><div class="eri">‚úÖ</div><div class="ert">Semua staff tepat waktu</div></div>`;return;}
  el.innerHTML=list.map(s=>{const a=absenData[s.id];const r=genLateReport(s,a);const la=calcLateAmt(s.start,padToSec(a.checkIn));return`<div class="lri"><div class="lri-hd"><div class="lri-av">${s.name.charAt(0)}</div><div style="flex:1;"><span class="lri-name">${s.name}</span>${a.staffId?`<span class="lri-sid">${a.staffId}</span>`:''}</div><span class="lri-lc">‚ö† ${la}</span><button class="lri-cpbtn" id="cpbtn-${s.id}" onclick="copySingleReport('${s.id}')">Copy</button></div><div class="lri-bd"><div class="rtb" id="rtb-${s.id}">${escHtml(r)}</div></div></div>`;}).join('');
}
function copySingleReport(key){const s=shifts.find(s=>s.id===key);const a=absenData[key];if(!s||!a||!a.checkIn){toast('Data belum lengkap!','warn');return;}const r=genLateReport(s,a);navigator.clipboard.writeText(r).then(()=>{toast(`Laporan ${s.name} disalin!`);const btn=document.getElementById(`cpbtn-${key}`);if(btn){btn.classList.add('copied');btn.textContent='‚úì Tersalin';setTimeout(()=>{btn.classList.remove('copied');btn.textContent='Copy';},2000);}}).catch(()=>clipFallback(r));const box=document.getElementById(`rtb-${key}`);if(box){box.classList.add('flash');setTimeout(()=>box.classList.remove('flash'),500);}}
function copyAllLateReports(){const all=getAbsenShifts();const list=all.filter(s=>{const a=absenData[s.id];if(!a||!a.checkIn)return false;return isLate(s.start,padToSec(a.checkIn))===true;});if(!list.length){toast('Tidak ada laporan!','warn');return;}const txt=list.map(s=>genLateReport(s,absenData[s.id])).join('\n\n---\n\n');navigator.clipboard.writeText(txt).then(()=>toast(`${list.length} laporan disalin!`)).catch(()=>clipFallback(txt));addH('absen',`Copy laporan telat: ${list.length} staff`,'var(--crimson)');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚òÖ‚òÖ‚òÖ LINE ABSENSI SYSTEM ‚òÖ‚òÖ‚òÖ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getLineDeadline(shiftStart){
  const[h,m]=shiftStart.split(':').map(Number);
  let dh=h,dm=35;
  if(m<35){dh=h-1;if(dh<0)dh=23;}
  return{h:dh,m:dm,totalSec:(dh*60+dm)*60};
}
function getLineSanksiDeadline(shiftStart){
  const[h]=shiftStart.split(':').map(Number);
  return{h,m:45,totalSec:(h*60+45)*60};
}
function getLineStatus(shiftStart,lineCheckIn){
  if(!lineCheckIn||lineCheckIn.trim()==='')return'belum';
  const ciSec=tsToSec(padToSec(lineCheckIn));
  const deadline=getLineDeadline(shiftStart);
  const sanksiLine=getLineSanksiDeadline(shiftStart);
  if(ciSec<=deadline.totalSec)return'ok';
  if(ciSec<=sanksiLine.totalSec)return'telat';
  return'sanksi';
}
function calcLineLateDuration(shiftStart,lineCheckIn){
  const ciSec=tsToSec(padToSec(lineCheckIn));
  const deadline=getLineDeadline(shiftStart);
  const diff=ciSec-deadline.totalSec;
  if(diff<=0)return null;
  return secsToHMS(diff);
}
function getDeadlineStr(shiftStart){const d=getLineDeadline(shiftStart);return`${pad2(d.h)}:${pad2(d.m)}:00`;}
function getDeadlineDisplay(shiftStart){const d=getLineDeadline(shiftStart);return`${pad2(d.h)}:${pad2(d.m)}`;}
function genSanksiReport(s,la){
  const ci=padToSec(la.lineCheckIn);const sid=(la.staffId||'').trim();
  const nd=sid?`${s.name} - ${sid}`:s.name;
  const status=getLineStatus(s.start,la.lineCheckIn);
  const lateDur=calcLineLateDuration(s.start,la.lineCheckIn)||'-';
  const deadline=getDeadlineStr(s.start);
  const statusLabel=status==='sanksi'?'SANKSI ‚Äî Melewati batas masuk office':'TELAT ‚Äî Melewati batas absen LINE';
  return`Info : TVTOTO\nPerihal : ${statusLabel}\nNama Staff : ${nd}\n\nJam Kerja : ${fmtWIB(s.start+':00')} - ${fmtWIB(s.end+':00')}\nBatas Absen LINE : ${fmtWIB(deadline)}\nAbsen LINE pada jam : ${fmtWIB(ci)}  ( Terlambat ${lateDur} )\nStatus : ${status.toUpperCase()}`;
}

function setLineTab(t){lineTab=t;document.querySelectorAll('.atab').forEach(x=>x.classList.remove('active'));document.getElementById('latab-'+t).classList.add('active');renderLineTable();updateLineCountdown();}
function getLineShifts(){return lineTab==='ALL'?shifts:shifts.filter(s=>s.type===lineTab);}

function renderLineTable(){
  const data=getLineShifts();const wrap=document.getElementById('lineAbsenTableWrap');
  document.getElementById('line-total-badge').textContent=`${data.length} Staff`;
  if(!data.length){wrap.innerHTML=`<div class="empty-red"><div class="eri">üí¨</div><div class="ert">Belum ada data shift</div></div>`;updateDashLineStats();return;}
  let html='';
  data.forEach((s,i)=>{
    const la=lineAbsenData[s.id]||{lineCheckIn:'',staffId:'',saved:false};const ci=la.lineCheckIn||'';
    const status=getLineStatus(s.start,ci);
    const deadline=getDeadlineDisplay(s.start);
    const stClass=status==='ok'?'is-ok':status==='sanksi'?'is-late':status==='telat'?'is-late':'';
    let label;
    if(status==='ok') label=`<span class="sp sp-ok">TEPAT</span>`;
    else if(status==='sanksi') label=`<span class="sp sp-late">SANKSI</span>`;
    else if(status==='telat') label=`<span class="sp" style="color:var(--gold);">TELAT</span>`;
    else label=`<span class="sp sp-belum"><span class="cd-line" id="cd-${s.id}">--:--</span></span>`;

    const bc=ci&&ci.length>=5?'hbtn hbtn-done':'hbtn hbtn-idle';
    html+=`<div class="sacard ${stClass}" id="line-card-${s.id}" style="grid-template-columns:38px 1.2fr 60px 80px 70px 38px;">
      <div class="sa-av" style="background:${status==='ok'?'#16a34a':status==='sanksi'?'#dc2626':'#333'}">L</div>
      <div class="sa-info"><div class="sa-name">${s.name}</div><div class="sa-meta">Batas: ${deadline}</div></div>
      <div class="sa-meta" style="justify-content:center;">${s.type}</div>
      <input class="sa-ti ${status==='sanksi'?'t-late':status==='ok'?'t-ok':''}" type="text" id="lci-${s.id}" value="${ci}" placeholder="HH:MM:SS" maxlength="8" oninput="onLineInput('${s.id}',this)" onblur="onLineBlur('${s.id}',this)">
      ${label}
      <button class="${bc}" id="lhbtn-${s.id}" onclick="doLineHadir('${s.id}')">üí¨</button>
    </div>`;
  });
  wrap.innerHTML=html;updateDashLineStats();renderLineReports();
}
function updateLineCountdown(){
  if(!document.getElementById('page-absen-line').classList.contains('active')) return;
  const now=new Date();const nowSec=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
  getLineShifts().forEach(s=>{
    const el=document.getElementById(`cd-${s.id}`);
    if(el){
      const deadline=getLineDeadline(s.start).totalSec;
      const diff=deadline-nowSec;
      if(diff>0){
        const m=Math.floor(diff/60);const sc=diff%60;
        el.textContent=`${pad2(m)}:${pad2(sc)}`;
        el.style.color=diff<300?'var(--crimson)':'var(--t3)'; 
      } else {
        el.textContent='LEWAT';el.style.color='var(--crimson)';
      }
    }
  });
}
function doLineHadir(key){
  const la=lineAbsenData[key]||{lineCheckIn:'',staffId:'',saved:false};
  if(la.lineCheckIn){delete lineAbsenData[key];debounceSave('lineAbsenData',lineAbsenData);renderLineTable();toast('Absen LINE direset','warn');return;}
  const now=new Date();const ts=`${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;
  const el=document.getElementById(`lci-${key}`);if(el)el.value=ts;
  lineAbsenData[key]={lineCheckIn:ts,staffId:la.staffId||'',saved:true};
  debounceSave('lineAbsenData',lineAbsenData);
  renderLineTable();toast('Absen LINE dicatat! üí¨');
}
function onLineInput(key,el){
  let v=el.value.replace(/[^0-9]/g,'');if(v.length>2)v=v.slice(0,2)+':'+v.slice(2);if(v.length>5)v=v.slice(0,5)+':'+v.slice(5);if(v.length>8)v=v.slice(0,8);el.value=v;
  lineAbsenData[key]=lineAbsenData[key]||{lineCheckIn:'',staffId:'',saved:false};lineAbsenData[key].lineCheckIn=v;
}
function onLineBlur(key,el){
  lineAbsenData[key]=lineAbsenData[key]||{lineCheckIn:'',staffId:'',saved:false};lineAbsenData[key].lineCheckIn=el.value;
  debounceSave('lineAbsenData',lineAbsenData);renderLineTable();
}
function saveAllLine(){
  const data=getLineShifts();let saved=0;
  data.forEach(s=>{const el=document.getElementById(`lci-${s.id}`);if(el&&el.value){lineAbsenData[s.id]=lineAbsenData[s.id]||{};lineAbsenData[s.id].lineCheckIn=el.value;lineAbsenData[s.id].saved=true;saved++;}});
  if(window.fbSaveNode)window.fbSaveNode('lineAbsenData',lineAbsenData);else localSave();
  renderLineTable();toast(`${saved} data LINE tersimpan! ‚òÅ`);
}
function setLineAllNow(){const now=new Date();const ts=`${pad2(now.getHours())}:${pad2(now.getMinutes())}:${pad2(now.getSeconds())}`;getLineShifts().forEach(s=>{const el=document.getElementById(`lci-${s.id}`);if(el&&!el.value){el.value=ts;lineAbsenData[s.id]=lineAbsenData[s.id]||{lineCheckIn:'',staffId:'',saved:false};lineAbsenData[s.id].lineCheckIn=ts;}});debounceSave('lineAbsenData',lineAbsenData);renderLineTable();toast('Diisi jam sekarang','info');}

function updateDashLineStats(){
  const data=shifts;let ok=0,late=0,sanksi=0;
  data.forEach(s=>{
    const la=lineAbsenData[s.id];if(!la||!la.lineCheckIn)return;
    const st=getLineStatus(s.start,la.lineCheckIn);
    if(st==='ok')ok++;else if(st==='telat')late++;else if(st==='sanksi')sanksi++;
  });
  const elOk=document.getElementById('s-line-ok');if(elOk)elOk.textContent=ok;
  const elSn=document.getElementById('s-line-sanksi');if(elSn)elSn.textContent=sanksi;
  const elOk2=document.getElementById('la-ok-count');if(elOk2)elOk2.textContent=ok;
  const elSn2=document.getElementById('la-sanksi-count');if(elSn2)elSn2.textContent=sanksi;
  const elLt2=document.getElementById('la-telat-count');if(elLt2)elLt2.textContent=late;
}
function renderLineReports(){
  const all=getLineShifts();const list=all.filter(s=>{const la=lineAbsenData[s.id];return la&&la.lineCheckIn&&(getLineStatus(s.start,la.lineCheckIn)==='sanksi'||getLineStatus(s.start,la.lineCheckIn)==='telat');});
  const el=document.getElementById('lineReportsList');
  if(!list.length){el.innerHTML=`<div class="empty-red" style="padding:44px 20px;"><div class="eri">‚úÖ</div><div class="ert">Tidak ada sanksi</div></div>`;return;}
  el.innerHTML=list.map(s=>{const la=lineAbsenData[s.id];const r=genSanksiReport(s,la);const st=getLineStatus(s.start,la.lineCheckIn);const badge=st==='sanksi'?'<span style="color:var(--crimson);font-weight:700;">SANKSI</span>':'<span style="color:var(--gold);font-weight:700;">TELAT</span>';return`<div class="lri"><div class="lri-hd"><div class="lri-av" style="background:${st==='sanksi'?'var(--crimson)':'var(--gold)'}">!</div><div style="flex:1;"><span class="lri-name">${s.name}</span> <small>${badge}</small></div><button class="lri-cpbtn" id="lcpbtn-${s.id}" onclick="copyLineSingleReport('${s.id}')">Copy</button></div><div class="lri-bd"><div class="rtb" id="lrtb-${s.id}">${escHtml(r)}</div></div></div>`;}).join('');
}
function copyLineSingleReport(key){const s=shifts.find(s=>s.id===key);const la=lineAbsenData[key];if(!s||!la){return;}const r=genSanksiReport(s,la);navigator.clipboard.writeText(r).then(()=>{toast('Laporan disalin!');}).catch(()=>clipFallback(r));}
function copyLineSanksiReports(){const all=getLineShifts();const list=all.filter(s=>{const la=lineAbsenData[s.id];return la&&la.lineCheckIn&&(getLineStatus(s.start,la.lineCheckIn)==='sanksi');});if(!list.length){toast('Tidak ada sanksi!','warn');return;}const txt=list.map(s=>genSanksiReport(s,lineAbsenData[s.id])).join('\n\n---\n\n');navigator.clipboard.writeText(txt).then(()=>toast('Semua sanksi disalin!')).catch(()=>clipFallback(txt));}

// ‚ïê‚ïê‚ïê OPERATOR ‚ïê‚ïê‚ïê
function saveOperators(){
  ['pagi','sore','malam'].forEach(sh=>{[1,2,3].forEach((i,idx)=>{const el=document.getElementById(`op-${sh}-${i}`);operators[sh][idx]=el?el.value.trim().toUpperCase():'';});});
  if(window.fbSaveNode)window.fbSaveNode('operators',operators);else localSave();
  renderAll();addH('operator','Setting operator disimpan','var(--gold)');toast('Setting operator tersimpan! ‚òÅ');renderOpSummary();
}
function loadOpInputs(){['pagi','sore','malam'].forEach(sh=>{[1,2,3].forEach((i,idx)=>{const el=document.getElementById(`op-${sh}-${i}`);if(el)el.value=operators[sh][idx]||'';});});}
function clearOperators(){operators={pagi:['','',''],sore:['','',''],malam:['','','']};loadOpInputs();if(window.fbSaveNode)window.fbSaveNode('operators',operators);else localSave();renderOpSummary();toast('Operator dihapus','warn');}
function getOpsForShift(t){const k=t.toLowerCase();if(!operators[k])return[];return operators[k].filter(n=>n&&n.trim()!=='');}
function isOperator(name,type){return getOpsForShift(type).includes(name.toUpperCase());}
function renderOpSummary(){const el=document.getElementById('opSummaryList');if(!el)return;const s2=[{key:'pagi',label:'üåÖ Pagi'},{key:'sore',label:'üå§ Sore'},{key:'malam',label:'üåô Malam'}];let html='';s2.forEach(({key,label})=>{const ops=operators[key].filter(n=>n&&n.trim()!=='');if(!ops.length)return;html+=`<div style="margin-bottom:10px;"><div style="font-family:'Josefin Sans',sans-serif;font-size:9.5px;color:var(--t3);text-transform:uppercase;letter-spacing:.18em;margin-bottom:6px;font-weight:700;">${label}</div><div style="display:flex;gap:7px;flex-wrap:wrap;">${ops.map(n=>`<span class="op-tag"><span>üëë</span>${n}</span>`).join('')}</div></div>`;});el.innerHTML=html||`<div class="empty-red" style="padding:16px;"><div class="eri">üëë</div><div class="ert">Belum ada operator</div></div>`;}

// ‚ïê‚ïê‚ïê RANDOM ‚ïê‚ïê‚ïê
function setTab(tab){activeTab=tab;document.querySelectorAll('.shift-tab').forEach(t=>{t.style.background=tab===t.id.replace('tab-','')?'rgba(196,18,48,.13)':'rgba(20,2,4,.8)';t.style.borderColor=tab===t.id.replace('tab-','')?'rgba(196,18,48,.38)':'rgba(196,18,48,.12)';t.style.color=tab===t.id.replace('tab-','')?'var(--crimson)':'var(--t2)';});}
function savePool(){const r=document.getElementById('jobdeskPool').value.trim();jdPool=r.split('\n').map(l=>l.trim()).filter(Boolean);if(window.fbSavePool)window.fbSavePool();else localSave();toast(`Pool: ${jdPool.length} jobdesk ‚òÅ`);}
function loadPoolInput(){document.getElementById('jobdeskPool').value=jdPool.join('\n');}
function loadSampleJD(){document.getElementById('jobdeskPool').value=['SCATTER','WD DANA','WD MANDIRI, BNI','DEPO BCA','MONITORING QRIS','WD OVO','CS LIVE CHAT','CUAN REPORT','REKAP HARIAN'].join('\n');toast('Contoh dimuat!','info');}
function runRandom(){const rp=document.getElementById('jobdeskPool').value.trim();if(rp)jdPool=rp.split('\n').map(l=>l.trim()).filter(Boolean);if(!jdPool.length){toast('Pool kosong!','warn');return;}if(!shifts.length){toast('Belum ada shift!','warn');return;}const btn=document.getElementById('rndBtn');btn.style.opacity='.6';btn.disabled=true;const dice=btn.querySelector('.dice-ico');if(dice)dice.classList.add('spinning');setTimeout(()=>{doRandom();btn.style.opacity='1';btn.disabled=false;if(dice)dice.classList.remove('spinning');},600);}

function doRandom(){
  let ts=[...shifts];
  if(activeTab!=='ALL') ts=shifts.filter(s=>s.type===activeTab);
  
  if(!ts.length){toast(`Tidak ada shift ${activeTab}!`,'warn');return;}
  
  const result=[];
  const tg={};
  ts.forEach(s=>{if(!tg[s.type])tg[s.type]=[];tg[s.type].push(s);});
  
  Object.entries(tg).forEach(([type,sl])=>{
    const opN=getOpsForShift(type);
    
    // Pisahkan staff berdasarkan peran
    const opS=sl.filter(s=>opN.includes(s.name.toUpperCase())); // Operator tetap
    // Filter untuk jobdesk acak: hanya KASIR (dan bukan operator)
    // Staff dengan role KAPTEN dan CS tidak masuk ke jobdesk acak
    const rS=sl.filter(s=>!opN.includes(s.name.toUpperCase()) && (!s.role || s.role === 'KASIR'));
    
    // Operator assign jobdesk OPERATOR
    opS.forEach(s=>{result.push({name:s.name,type:s.type,start:s.start,end:s.end,jobdesk:'OPERATOR',isOp:true,role:s.role});});
    
    // Acak jobdesk untuk Kasir
    const sp=shuffle([...jdPool]);
    rS.forEach((s,i)=>{result.push({name:s.name,type:s.type,start:s.start,end:s.end,jobdesk:sp[i%sp.length],isOp:false,role:s.role});});
  });
  
  lastResult=result;
  if(window.fbSaveResult)window.fbSaveResult();else localSave();
  showResult(result);
  addH('random',`Acak: ${result.length} staff`,'#00f5d4');
  toast(`Jobdesk diacak! ${result.length} staff ‚òÅ`);
  updateExpPrev();
}

function showResult(result){if(!result.length)return;document.getElementById('resultPanel').style.display='block';document.getElementById('resultEmpty').style.display='none';document.getElementById('resultCount').textContent=`${result.length} Staff`;document.getElementById('resultShiftLabel').textContent=activeTab==='ALL'?'Semua':activeTab;const tb=document.getElementById('resultTB');tb.innerHTML=result.map((r,i)=>`<tr style="${r.isOp?'background:rgba(196,18,48,.04);':''}"><td style="padding:11px 16px;color:var(--t3);font-family:'JetBrains Mono',monospace;border-bottom:1px solid rgba(196,18,48,.07);">${i+1}</td><td style="padding:11px 16px;border-bottom:1px solid rgba(196,18,48,.07);"><div style="display:flex;align-items:center;"><div class="av" style="background:${r.isOp?'linear-gradient(135deg,#7c3aed,#4c1d95)':'linear-gradient(135deg,var(--gold),var(--gold2))'}">${r.name.charAt(0)}</div><strong style="font-family:'Josefin Sans',sans-serif;letter-spacing:.04em;">${r.name}</strong>${r.isOp?'<span class="op-tag" style="margin-left:8px;font-size:10px;"><span>üëë</span>OP</span>':''}</div></td><td style="padding:11px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${shiftBadge(r.type)}</td><td style="padding:11px 16px;border-bottom:1px solid rgba(196,18,48,.07);font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--t2);">${r.start} ‚Äì ${r.end}</td><td style="padding:11px 16px;border-bottom:1px solid rgba(196,18,48,.07);"><span class="jdb ${r.isOp?'jdb-op':'jdb-rnd'}">${r.isOp?'üëë':'üé≤'} ${r.jobdesk}</span></td><td style="padding:11px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${r.isOp?`<span class="badge" style="background:rgba(124,58,237,.09);color:#c084fc;border:1px solid rgba(124,58,237,.25);">TETAP</span>`:`<span class="badge" style="background:rgba(0,245,212,.06);color:#00f5d4;border:1px solid rgba(0,245,212,.16);">ACAK</span>`}</td></tr>`).join('');}
function clearResult(){lastResult=[];if(window.fbSaveResult)window.fbSaveResult();else localSave();document.getElementById('resultPanel').style.display='none';document.getElementById('resultEmpty').style.display='block';toast('Hasil dibersihkan','warn');}
function copyResult(){if(!lastResult.length){toast('Tidak ada hasil!','warn');return;}const text=lastResult.map((r,i)=>`${i+1}. ${r.name} ‚Üí ${r.jobdesk}${r.isOp?' [OPERATOR]':''}`).join('\n');navigator.clipboard.writeText(text).then(()=>toast('Hasil disalin!')).catch(()=>clipFallback(text));}
function shuffle(arr){const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

// ‚ïê‚ïê‚ïê SHIFT MANAGEMENT ‚ïê‚ïê‚ïê
function addShift(d){
  const data=d||{
    name:document.getElementById('sh-name').value.trim().toUpperCase(),
    date:document.getElementById('sh-date').value,
    start:document.getElementById('sh-start').value,
    end:document.getElementById('sh-end').value,
    type:document.getElementById('sh-type').value,
    role:document.getElementById('sh-role').value,
    note:document.getElementById('sh-note').value.trim()
  };
  if(!data.name){toast('Nama staff wajib!','warn');return;}if(!data.start||!data.end){toast('Jam wajib diisi!','warn');return;}
  
  // Jika role kosong (misal import lama), default Kasir
  if(!data.role) data.role = 'KASIR';

  shifts.push({...data,id:Date.now()+'_'+Math.random().toString(36).substr(2,5),hours:hrsN(data.start,data.end)});
  if(window.fbSaveShifts)window.fbSaveShifts();else localSave();
  addH('shift',`Shift: ${data.name} (${data.role})`,'var(--gold)');
  if(!d){['sh-name','sh-start','sh-end','sh-note'].forEach(id=>document.getElementById(id).value='');document.getElementById('sh-total').textContent='‚Äî jam';}
  renderAll();toast(`Shift ${data.name} ditambahkan! ‚òÅ`);
}
function delShift(id){shifts=shifts.filter(s=>s.id!==id);if(window.fbSaveShifts)window.fbSaveShifts();else localSave();addH('delete','Shift dihapus','var(--crimson)');renderAll();toast('Dihapus','warn');}
function filterST(q){stSearch=q.toLowerCase();renderShiftTbl();}
function filterSTtype(v){stType=v;renderShiftTbl();}

// Parse line, modified to just parse standard format. Role is default Kasir for pasted data.
function parseLine2(line){line=line.trim();if(!line||/^(NO|#|NAMA|SHIFT|START|END|KET|-+)/i.test(line))return null;const parts=line.split('|').map(p=>p.trim()).filter(Boolean);const tRx=/^\d{1,2}:\d{2}(:\d{2})?$/;if(parts.length>=3){const ti=parts.reduce((a,p,i)=>{if(tRx.test(p))a.push(i);return a;},[]);if(ti.length>=2){let st=parts[ti[0]].substring(0,5),en=parts[ti[1]].substring(0,5);let nm=parts.slice(0,ti[0]).join(' ').replace(/^\d+\s*/,'').trim().toUpperCase();if(nm)return{name:nm,start:st,end:en};}let nm=parts[0].replace(/^\d+\s*/,'').trim().toUpperCase();if(nm&&tRx.test(parts[1])&&tRx.test(parts[2]))return{name:nm,start:parts[1].substring(0,5),end:parts[2].substring(0,5)};}const times=(line.match(/\d{1,2}:\d{2}(:\d{2})?/g)||[]).map(t=>t.substring(0,5));if(times.length>=2){let before=line.substring(0,line.indexOf(times[0])).replace(/^\d+\s+/,'').trim().toUpperCase();if(before.length>1&&before.length<60)return{name:before,start:times[0],end:times[1]};}return null;}

function importPaste(){
  const raw=document.getElementById('shiftPaste').value.trim();if(!raw){toast('Kotak paste kosong!','warn');return;}
  let added=0,skip=0;
  const selectedRole=document.getElementById('sh-role').value || 'KASIR';
  raw.split('\n').forEach(line=>{
    const p=parseLine2(line);
    if(!p){skip++;return;}
    shifts.push({
      ...p,
      role:selectedRole,
      date:todayS(),
      type:detectType(p.start),
      hours:hrsN(p.start,p.end),
      id:Date.now()+'_'+Math.random().toString(36).substr(2,5),
      note:''
    });
    added++;
  });
  if(window.fbSaveShifts)window.fbSaveShifts();else localSave();
  renderAll();
  addH('import',`Import: ${added} shift (${selectedRole})`,'#00f5d4');
  toast(`${added} shift diimport! ‚òÅ`,added>0?'ok':'warn');
  if(added>0)document.getElementById('shiftPaste').value='';
}
function processPaste(){
  const r=document.getElementById('quickPaste').value.trim();
  if(!r){toast('Kotak kosong!','warn');return;}
  const role=document.getElementById('quickPasteRole').value;
  // Set default role di import manual agar saat importPaste terpanggil, ia menggunakan role ini
  document.getElementById('sh-role').value=role;
  document.getElementById('shiftPaste').value=r;
  importPaste();
  document.getElementById('quickPaste').value='';
  gp('shift',document.querySelectorAll('.nitem')[3]);
}

// ‚ïê‚ïê‚ïê MONITOR ‚ïê‚ïê‚ïê
function filterMon(q){monSearch=q.toLowerCase();renderMonTbl();}
function filterMonStatus(v){monStat=v;renderMonTbl();}
function refreshMon(){renderMonTbl();updateStats();renderDashList();renderChecklist();updateDashLineStats();}

// ‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê
function addH(type,desc,color){
  const n=new Date(),p=v=>String(v).padStart(2,'0');
  hist.unshift({type,desc,color,time:`${p(n.getHours())}:${p(n.getMinutes())}`,date:n.toLocaleDateString('id-ID')});
  if(hist.length>100)hist=hist.slice(0,100);
  debounceSave('hist',hist);renderHistLog();document.getElementById('npip').style.display='block';
}
function clearHist(){if(!confirm('Hapus history?'))return;hist=[];if(window.fbSaveHist)window.fbSaveHist();else localSave();renderHistLog();toast('History dihapus','warn');}

// ‚ïê‚ïê‚ïê CHECKLIST ‚ïê‚ïê‚ïê
function renderChecklist(){const names=[...new Set(shifts.map(s=>s.name))];const el=document.getElementById('checklistPanel');if(!names.length){el.innerHTML=`<div class="empty-red"><div class="eri">üìã</div><div class="ert">Tambah shift dulu</div></div>`;return;}shifts.forEach(s=>{if(shiftStatus(s)==='AKTIF'&&!checked.includes(s.name))checked.push(s.name);});debounceSave('checked',checked);el.innerHTML=`<div class="check-grid">`+names.map(name=>{const isC=checked.includes(name);const st=shiftStatus(shifts.find(s=>s.name===name)||{start:'',end:''});return`<div class="check-item" style="border-color:${isC?'rgba(34,197,94,.18)':'var(--border)'}"><div class="cbox ${isC?'checked':''}" onclick="toggleCheck('${name}')"></div><div><div style="font-family:'Josefin Sans',sans-serif;font-weight:700;font-size:13px;letter-spacing:.04em;">${name}</div><div style="font-family:'Josefin Sans',sans-serif;font-size:11px;letter-spacing:.06em;color:${st==='AKTIF'?'var(--green)':st==='SELESAI'?'var(--t3)':'var(--crimson)'};">${st}</div></div></div>`;}).join('')+`</div>`;const unc=names.filter(n=>!checked.includes(n)).length;document.getElementById('checkBadge').textContent=`${unc} Belum`;}
function toggleCheck(name){const i=checked.indexOf(name);if(i>=0)checked.splice(i,1);else checked.push(name);debounceSave('checked',checked);renderChecklist();}

// ‚ïê‚ïê‚ïê STATS ‚ïê‚ïê‚ïê
function updateStats(){const u=new Set(shifts.map(s=>s.name)).size;const a=shifts.filter(s=>shiftStatus(s)==='AKTIF').length;document.getElementById('s-aktif').textContent=u;document.getElementById('s-shift').textContent=shifts.length;document.getElementById('s-jd').textContent=lastResult.length;document.getElementById('s-kerja').textContent=a;updateDashLineStats();}

// ‚ïê‚ïê‚ïê RENDER TABLES ‚ïê‚ïê‚ïê
function renderShiftTbl(){
  let data=[...shifts];
  if(stSearch)data=data.filter(s=>s.name.toLowerCase().includes(stSearch));
  if(stType)data=data.filter(s=>s.type===stType);
  document.getElementById('shiftCount').textContent=`${shifts.length} Shift`;
  const tb=document.getElementById('shiftTB');
  if(!data.length){tb.innerHTML=`<tr><td colspan="9"><div class="empty-red"><div class="eri">‚è±</div><div class="ert">Tidak ada data shift</div></div></td></tr>`;return;}
  tb.innerHTML=data.map((s,i)=>{
    const opM=isOperator(s.name,s.type)?` <span class="op-tag" style="font-size:10px;"><span>üëë</span></span>`:'';
    const roleBadge = s.role==='KAPTEN' ? '<span class="badge" style="background:rgba(232,185,79,.15);color:var(--gold);">KAPTEN</span>' : 
                      s.role==='CS' ? '<span class="badge" style="background:rgba(0,245,212,.15);color:var(--teal);">CS</span>' : 
                      '<span class="badge" style="background:rgba(255,255,255,.1);">KASIR</span>';
    return`<tr><td style="padding:12px 16px;color:var(--t3);font-family:'JetBrains Mono',monospace;border-bottom:1px solid rgba(196,18,48,.07);">${i+1}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);"><div style="display:flex;align-items:center;"><div class="av">${s.name.charAt(0)}</div><strong style="font-family:'Josefin Sans',sans-serif;letter-spacing:.04em;">${s.name}</strong>${opM}</div></td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${roleBadge}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${shiftBadge(s.type)}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);font-family:'JetBrains Mono',monospace;font-size:12px;">${s.start}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);font-family:'JetBrains Mono',monospace;font-size:12px;">${s.end}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);color:#ff9966;font-family:'JetBrains Mono',monospace;">${hrs(s.start,s.end)}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${statusBadge(shiftStatus(s))}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);"><button class="btn btn-rose btn-sm" onclick="delShift('${s.id}')">‚úï</button></td></tr>`;
  }).join('');
}

function renderMonTbl(){
  let data=[...shifts];
  if(monSearch)data=data.filter(s=>s.name.toLowerCase().includes(monSearch));
  if(monStat)data=data.filter(s=>shiftStatus(s)===monStat);
  const tb=document.getElementById('monTB');
  if(!data.length){tb.innerHTML=`<tr><td colspan="9"><div class="empty-red"><div class="eri">üì°</div><div class="ert">Tidak ada data</div></div></td></tr>`;return;}
  tb.innerHTML=data.map((s,i)=>{
    const st=shiftStatus(s),pr=shiftProg(s);
    const r=lastResult.find(r=>r.name===s.name);
    const jd=r?`<span class="jdb ${r.isOp?'jdb-op':'jdb-rnd'}">${r.isOp?'üëë':'üé≤'} ${r.jobdesk}</span>`:`<span style="color:var(--t3);font-size:11px;">Belum diacak</span>`;
    const ag=st==='AKTIF'?'linear-gradient(135deg,#16a34a,#065f46)':st==='SELESAI'?'linear-gradient(135deg,var(--t3),var(--t4))':'linear-gradient(135deg,var(--crimson),#be123c)';
    const lineSt=lineAbsenData[s.id]?getLineStatus(s.start,lineAbsenData[s.id].lineCheckIn||''):'belum';
    const lBadge=lineSt==='ok'?'<span class="badge b-line">üí¨ LINE ‚úÖ</span>':lineSt==='sanksi'?'<span class="badge b-sanksi">üí¨ SANKSI</span>':lineSt==='telat'?'<span class="badge" style="background:rgba(232,185,79,.09);color:var(--gold);border:1px solid rgba(232,185,79,.2);">üí¨ TELAT</span>':'';
    const roleBadge = s.role==='KAPTEN' ? '<span class="badge" style="background:rgba(232,185,79,.15);color:var(--gold);">KPT</span>' : 
                      s.role==='CS' ? '<span class="badge" style="background:rgba(0,245,212,.15);color:var(--teal);">CS</span>' : 
                      '<span class="badge" style="background:rgba(255,255,255,.1);">KSR</span>';
    return`<tr><td style="padding:12px 16px;color:var(--t3);font-family:'JetBrains Mono',monospace;border-bottom:1px solid rgba(196,18,48,.07);">${i+1}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);"><div style="display:flex;align-items:center;"><div class="av" style="background:${ag}">${s.name.charAt(0)}</div><div><strong style="font-family:'Josefin Sans',sans-serif;letter-spacing:.04em;">${s.name}</strong><div>${lBadge}</div></div></div></td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${roleBadge}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${shiftBadge(s.type)}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);font-family:'JetBrains Mono',monospace;font-size:12px;">${s.start} ‚Äì ${s.end}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);color:#ff9966;font-family:'JetBrains Mono',monospace;">${hrs(s.start,s.end)}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${jd}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);">${statusBadge(st)}</td><td style="padding:12px 16px;border-bottom:1px solid rgba(196,18,48,.07);"><div class="tbar" style="width:80px;"><div class="tfill" style="width:${pr}%"></div></div></td></tr>`;
  }).join('');
}

function renderDashList(){const el=document.getElementById('dashShiftList');if(!shifts.length){el.innerHTML=`<div class="empty-red"><div class="eri">‚è≥</div><div class="ert">Belum ada data shift</div></div>`;return;}el.innerHTML=shifts.slice(0,8).map(s=>{const st=shiftStatus(s),pr=shiftProg(s);const rjd=lastResult.find(r=>r.name===s.name);const ag=st==='AKTIF'?'linear-gradient(135deg,#16a34a,#065f46)':'linear-gradient(135deg,var(--gold),var(--gold2))';const lineSt=lineAbsenData[s.id]?getLineStatus(s.start,lineAbsenData[s.id].lineCheckIn||''):'belum';const lmark=lineSt==='ok'?'üí¨‚úÖ':lineSt==='sanksi'?'üö®':lineSt==='telat'?'‚ö†':'';return`<div class="scard2"><div style="display:flex;align-items:center;gap:8px;margin-bottom:7px;"><div class="av" style="width:25px;height:25px;font-size:11px;background:${ag}">${s.name.charAt(0)}</div><strong style="flex:1;font-family:'Josefin Sans',sans-serif;font-size:13px;letter-spacing:.04em;">${s.name} ${lmark}</strong>${shiftBadge(s.type)} ${statusBadge(st)}</div><div class="tbar"><div class="tfill" style="width:${pr}%"></div></div><div style="display:flex;gap:11px;font-size:11.5px;color:var(--t2);font-family:'JetBrains Mono',monospace;"><span>üïê ${s.start}‚Äì${s.end}</span>${rjd?`<span class="jdb ${rjd.isOp?'jdb-op':'jdb-rnd'}" style="font-size:10px;padding:2px 8px;">${rjd.isOp?'üëë':'üé≤'} ${rjd.jobdesk}</span>`:''}</div></div>`;}).join('');if(shifts.length>8)el.insertAdjacentHTML('beforeend',`<div style="text-align:center;margin-top:8px;"><button class="btn btn-ghost btn-sm" onclick="gp('shift',document.querySelectorAll('.nitem')[3])">Lihat semua ‚Üí</button></div>`);}

function renderHistLog(){document.getElementById('histCount').textContent=`${hist.length} Entri`;const el=document.getElementById('histLog');if(!hist.length){el.innerHTML=`<div class="empty-red"><div class="eri">üóÇ</div><div class="ert">Log kosong</div></div>`;return;}el.innerHTML=hist.map(h=>`<div class="log-item"><div class="log-time">${h.time}</div><div class="log-dot" style="background:${h.color||'var(--gold)'}"></div><div style="flex:1;"><div class="log-title">${h.desc}</div><div class="log-desc">${h.date}</div></div></div>`).join('');}
function updateDL(){const names=[...new Set(shifts.map(s=>s.name))];document.querySelectorAll('#staffDL').forEach(dl=>{dl.innerHTML=names.map(n=>`<option value="${n}">`).join('');});}
function updateExpPrev(){document.getElementById('expShiftPrev').textContent=shifts.length?shifts.map((s,i)=>`${String(i+1).padStart(2,' ')}. ${s.name.padEnd(28,' ')} | ${s.type.padEnd(7,' ')} | ${s.role.padEnd(7,' ')} | ${s.start} ‚Äì ${s.end} | ${hrs(s.start,s.end)}`).join('\n'):'Belum ada data.';document.getElementById('expResultPrev').textContent=lastResult.length?lastResult.map((r,i)=>`${String(i+1).padStart(2,' ')}. ${r.name.padEnd(28,' ')} ‚Üí ${r.jobdesk.padEnd(20,' ')} ${r.isOp?'[OPERATOR]':'[ACAK]'}`).join('\n'):'Belum ada hasil acak.';}
function dl2(fn,c,t='text/plain'){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:t}));a.download=fn;a.click();}
function expCSV(type){if(type==='shift'){if(!shifts.length){toast('Tidak ada data!','warn');return;}dl2('shift.csv',['No,Nama,Role,Tipe,Mulai,Selesai,Total',...shifts.map((s,i)=>`${i+1},"${s.name}",${s.role},${s.type},${s.start},${s.end},"${hrs(s.start,s.end)}"`)].join('\n'),'text/csv');}else{if(!lastResult.length){toast('Tidak ada hasil!','warn');return;}dl2('jobdesk.csv',['No,Nama,Shift,Mulai,Selesai,Jobdesk,Tipe,Role',...lastResult.map((r,i)=>`${i+1},"${r.name}",${r.type},${r.start},${r.end},"${r.jobdesk}",${r.isOp?'OPERATOR':'ACAK'},${r.role}`)].join('\n'),'text/csv');}toast('CSV diunduh!');}
function expJSON(type){const data=type==='shift'?shifts:lastResult;if(!data.length){toast('Tidak ada data!','warn');return;}dl2(`${type}.json`,JSON.stringify(data,null,2),'application/json');toast('JSON diunduh!');}
function printTbl(type){let rows,title,headers;if(type==='shift'){if(!shifts.length){toast('Tidak ada data!','warn');return;}title='SHIFT REPORT';headers=['No','Nama','Role','Tipe','Mulai','Selesai','Total'];rows=shifts.map((s,i)=>`<tr><td>${i+1}</td><td>${s.name}</td><td>${s.role}</td><td>${s.type}</td><td>${s.start}</td><td>${s.end}</td><td>${hrs(s.start,s.end)}</td></tr>`).join('');}else{if(!lastResult.length){toast('Tidak ada hasil!','warn');return;}title='DISTRIBUSI JOBDESK';headers=['No','Nama','Shift','Jam','Jobdesk','Tipe','Role'];rows=lastResult.map((r,i)=>`<tr><td>${i+1}</td><td>${r.name}</td><td>${r.type}</td><td>${r.start}‚Äì${r.end}</td><td>${r.jobdesk}</td><td>${r.isOp?'OPERATOR':'ACAK'}</td><td>${r.role}</td></tr>`).join('');}const w=window.open('','_blank');w.document.write(`<html><head><title>${title}</title><style>body{font-family:sans-serif;font-size:12px;padding:20px;}table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ccc;padding:7px;text-align:left;}th{background:#111;color:#fff;}</style></head><body><h2>${title} ‚Äî ${new Date().toLocaleDateString('id-ID')}</h2><table><thead><tr>${headers.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>${rows}</tbody></table></body></html>`);w.document.close();w.print();}
function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function clipFallback(text){const ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();toast('Disalin!');}

function exportLineCSV(){
  const data=shifts;if(!data.length){toast('Tidak ada data!','warn');return;}
  const rows=['No,Nama,Role,Tipe Shift,Jam Mulai,Jam Selesai,Deadline LINE,Jam Absen LINE,Status LINE,Lama Terlambat'];
  data.forEach((s,i)=>{const la=lineAbsenData[s.id]||{};const ci=la.lineCheckIn||'';const st=getLineStatus(s.start,ci);const dl=getDeadlineStr(s.start);const ld=ci&&st!=='ok'&&st!=='belum'?calcLineLateDuration(s.start,ci)||'-':'-';rows.push(`${i+1},"${s.name}",${s.role},${s.type},${s.start},${s.end},${dl.substring(0,5)},"${ci}",${st.toUpperCase()},"${ld}"`);});
  dl2('absensi_line.csv',rows.join('\n'),'text/csv');toast('Export LINE CSV berhasil!');addH('export','Export Absensi LINE CSV','var(--line-green)');
}
function printLineReport(){
  const data=shifts;if(!data.length){toast('Tidak ada data!','warn');return;}
  const now=new Date().toLocaleString('id-ID');
  let rows=data.map((s,i)=>{const la=lineAbsenData[s.id]||{};const ci=la.lineCheckIn||'-';const st=getLineStatus(s.start,la.lineCheckIn);const dl=getDeadlineStr(s.start);const ld=la.lineCheckIn&&st!=='ok'&&st!=='belum'?calcLineLateDuration(s.start,la.lineCheckIn)||'-':'-';const stColor=st==='ok'?'#16a34a':st==='sanksi'?'#dc2626':st==='telat'?'#ca8a04':'#6b7280';const stLabel=st==='ok'?'‚úÖ TEPAT':st==='sanksi'?'üö® SANKSI':st==='telat'?'‚ö† TELAT':'‚è≥ BELUM';return`<tr><td>${i+1}</td><td><strong>${s.name}</strong>${la.staffId?` <small>[${la.staffId}]</small>`:''}</td><td>${s.role}</td><td>${s.type}</td><td>${s.start}‚Äì${s.end}</td><td>${dl.substring(0,5)}</td><td style="font-family:monospace">${ci}</td><td style="color:${stColor};font-weight:700">${stLabel}</td><td>${ld}</td></tr>`;}).join('');
  const w=window.open('','_blank');w.document.write(`<html><head><title>Laporan LINE</title><style>body{font-family:'Segoe UI',sans-serif;font-size:12px;padding:24px;}table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px 10px;text-align:left;}th{background:#111;color:#fff;font-size:11px;}tr:nth-child(even){background:#f9f9f9;}</style></head><body><h1 style="color:#b91c1c;">üö´ Laporan Absensi LINE ‚Äî TVTOTO OPS</h1><h2 style="font-weight:400;color:#666;">Dicetak: ${now}</h2><table><thead><tr><th>#</th><th>Nama Staff</th><th>Role</th><th>Shift</th><th>Jam Kerja</th><th>Deadline</th><th>Jam Absen</th><th>Status</th><th>Terlambat</th></tr></thead><tbody>${rows}</tbody></table></body></html>`);w.document.close();w.print();
}
function copyLineAll(){
  const data=getLineShifts();if(!data.length){toast('Tidak ada data!','warn');return;}
  let txt=`LAPORAN ABSENSI LINE ‚Äî TVTOTO OPS\n${'‚ïê'.repeat(50)}\n\n`;
  data.forEach((s,i)=>{const la=lineAbsenData[s.id]||{};const ci=la.lineCheckIn||'‚Äî';const st=getLineStatus(s.start,la.lineCheckIn);const dl=getDeadlineStr(s.start);const stLabel=st==='ok'?'‚úÖ TEPAT WAKTU':st==='sanksi'?'üö® SANKSI':st==='telat'?'‚ö† TELAT':'‚è≥ BELUM';txt+=`${i+1}. ${s.name}${la.staffId?` [${la.staffId}]`:''}\n   Role     : ${s.role}\n   Shift    : ${s.type} | ${s.start} ‚Äì ${s.end}\n   Deadline : ${dl.substring(0,5)} WIB\n   Absen    : ${ci} WIB\n   Status   : ${stLabel}\n\n`;});
  navigator.clipboard.writeText(txt).then(()=>toast('Semua data LINE disalin!')).catch(()=>clipFallback(txt));
}

function renderAll(){renderShiftTbl();renderMonTbl();renderDashList();renderHistLog();updateStats();renderChecklist();updateDL();renderOpSummary();updateDashLineStats();const ap=document.getElementById('page-absen');if(ap&&ap.classList.contains('active'))renderAbsenTable();const lp=document.getElementById('page-absen-line');if(lp&&lp.classList.contains('active'))renderLineTable();}
window.renderAll=renderAll;window.renderAbsenTable=renderAbsenTable;window.renderLineTable=renderLineTable;window.renderHistLog=renderHistLog;window.renderChecklist=renderChecklist;window.renderOpSummary=renderOpSummary;window.updateDashLineStats=updateDashLineStats;window.loadOpInputs=loadOpInputs;window.loadPoolInput=loadPoolInput;window.updateExpPrev=updateExpPrev;window.showResult=showResult;

setInterval(checkLineDeadlineAlert,60000);
function checkLineDeadlineAlert(){const now=new Date();const nowSec=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();shifts.forEach(s=>{const la=lineAbsenData[s.id];if(la&&la.lineCheckIn)return;const dl=getLineDeadline(s.start);const diff=dl.totalSec-nowSec;if(diff>0&&diff<=300){const m=Math.floor(diff/60),sec=diff%60;toast(`‚è∞ ${s.name} ‚Äî Deadline LINE ${pad2(m)}:${pad2(sec)} lagi!`,'warn');}});}

// ‚îÄ‚îÄ‚îÄ KEYBOARD SHORTCUTS ‚îÄ‚îÄ‚îÄ
document.addEventListener('keydown',(e)=>{
  if(e.ctrlKey||e.metaKey){
    const navItems=document.querySelectorAll('.nitem');
    if(e.key==='1'){e.preventDefault();gp('dashboard',navItems[0]);}
    else if(e.key==='2'){e.preventDefault();gp('jobdesk-acak',navItems[1]);}
    else if(e.key==='3'){e.preventDefault();gp('shift',navItems[3]);}
    else if(e.key==='4'){e.preventDefault();gp('absen',navItems[5]);}
    else if(e.key==='5'){e.preventDefault();gp('absen-line',navItems[6]);}
  }
});

// ‚îÄ‚îÄ‚îÄ PROTEKSI ‚îÄ‚îÄ‚îÄ
document.addEventListener("keydown",function(e){if(e.ctrlKey&&e.key.toLowerCase()==="u"){e.preventDefault();return false;}if(e.ctrlKey&&e.shiftKey&&e.key.toLowerCase()==="i"){e.preventDefault();return false;}if(e.ctrlKey&&e.shiftKey&&e.key.toLowerCase()==="j"){e.preventDefault();return false;}if(e.ctrlKey&&e.key.toLowerCase()==="s"){e.preventDefault();return false;}if(e.key==="F12"){e.preventDefault();return false;}});
document.addEventListener("contextmenu",function(e){e.preventDefault();});
</script>
</body>
</html>
